<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />

    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" href="/images/icons/icon-152x152.png" />
    <!-- theme-color defines the top bar color-->
    <meta name="theme-color" content="#575757" />
    <meta
      http-equiv="X-Content-Security-Policy"
      content="default-src 'self'; script-src 'report-sample' 'self' https://app.posthog.com/static/array.js https://www.googletagmanager.com/gtag/js; style-src 'report-sample' 'self' https://fonts.googleapis.com; object-src 'none'; base-uri 'self'; connect-src 'self' https://app.posthog.com; font-src 'self'; frame-src 'self'; img-src 'self'; manifest-src 'self'; media-src 'self'; report-uri https://pauldambra.report-uri.com/r/d/csp/enforce; worker-src 'self';"
    />
    <!-- Add to home screen for Safari on iOS-->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="MiRaNo" />
    <link rel="apple-touch-icon" href="/images/icons/icon-152x152.png" />

    <!-- Add to home screen for Windows-->
    <meta
      name="msapplication-TileImage"
      content="/images/icons/icon-152x152.png"
    />
    <meta name="msapplication-TileColor" content="#575757" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Astronomical Database Identfier</title>
    <link rel="canonical" href="https://pauldambra.dev/2013/11/astronomical-database-identfier.html" />
    <meta property="og:url" content="https://pauldambra.dev/2013/11/astronomical-database-identfier.html" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Astronomical Database Identfier" />
    <meta
      property="og:description"
      content="a blog about software engineering"
    />
    <meta
      property="og:image"
      content="https://pauldambra.dev/images/cardboard.jpg"
    />
    <meta name="twitter:creator" content="@pauldambra" />
    <meta property="fb:app_id" content="1029758320473951" />

    <meta name="viewport" content="width=device-width" />
    <meta
      name="description"
      content="a blog about software engineering"
    />
    <meta property="fb:pages" content="1029758320473951" />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="Mindless Rambling Nonsense"
      href="https://pauldambra.dev/feed.xml"
    />
    <link rel="shortcut icon" href="/favicon.ico" />

    <link rel="prefetch" href="/images/cardboard.jpg" />

    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <meta name="msvalidate.01" content="54691C3C7B863CEE60F0305D6EDFF7A8" />
    <meta
      name="google-site-verification"
      content="hLKEdujpXNQ9PSZWEcQkwxCgL2z1tWxVedeaUmttH7c"
    />
    <script>
    !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group identify setPersonProperties setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags resetGroups onFeatureFlags addFeatureFlagsHandler onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
    posthog.init('phc_YwZdW7eDzRlzm3YiNvZpAR5oGhmc9nYeVwuUq5mef3b', {
        api_host: 'https://ph.pauldambra.dev',
        defaults: '2026-01-30'
    })
</script>

  </head>
  <body class="flex flex-col h-screen">
    <header class="flex flex-col px-8 pt-4 text-white text-xl" role="banner">
  <div class="flex flex-col sm:flex-row">
    <div class="no-underline hover:underline">
      <a href="/">Mindless Rambling Nonsense</a>
    </div>
    <div class="flex-grow my-2 sm:m-0"></div>
    <div class="flex justify-start items-end flex-col text-sm">
      <div class="flex items-center">
        <div class="mr-4">Paul D'Ambra</div>
        <a href="https://github.com/pauldambra" rel="noopener">
          <img
            src="/images/GitHub-Mark-Light-32px.png"
            alt="pauldambra on github"
            width="32"
            height="32"
          />
        </a>
      </div>
      <div class="flex items-center">
        <div class="mr-4">Fangler</div>
        <a href="https://twitter.com/pauldambra" rel="noopener">
          <img
            src="/images/twitter-32.png"
            alt="pauldambra on twitter"
            width="32"
            height="32"
          />
        </a>
      </div>
      <div class="flex items-center">
        <div class="mr-4"></div>
        <a rel="me" href="https://mastodon.me.uk/@pauldambra">
        </a>
      </div>
    </div>
  </div>
  <div class="flex-grow"></div>
  <div
    class="flex align-middle items-start px-2 py-4 text-white space-x-4 text-lg"
  >
    <nav role="navigation">
      <a class="underline" href="/">Blog Posts</a>
      <a class="underline ml-5" href="/weeknotes.html">Week Notes</a>
      <a class="underline ml-5" href="/kids-games.html">Kids games</a>
    </nav>
  </div>
</header>

    <main role="main" class="bg-white p-4 w-11/12 m-auto flex-auto flex-grow">
      

<script type="application/ld+json">
  {
     "@context":"http://schema.org",
     "@type":"BlogPosting",
     "headline":"Astronomical Database Identfier",
     "genre":"",
     "keywords":"",
     "wordCount":"817",
     "url":"https://pauldambra.dev/2013/11/astronomical-database-identfier.html",
     "datePublished":"2013-11-22",
     "author":{
        "@type":"Person",
        "name":"Paul D'Ambra",
        "sameAs":[
          "https://twitter.com/pauldambra",
          "https://github.com/pauldambra",
          "https://plus.google.com/u/0/+PaulDAmbraPlus"
        ]
     },
     "publisher":{
  "@type": "Organization",
      "name": "Paul D'Ambra",
      "sameAs": [
          "https://twitter.com/pauldambra",
          "https://github.com/pauldambra",
          "https://plus.google.com/u/0/+PaulDAmbraPlus"
      ],
      "logo": {
        "@type": "ImageObject",
        "contentUrl": "https://pauldambra.dev/images/logo.png",
          "url": "https://pauldambra.dev"
      }
     },
     "image":{
        "@type":"ImageObject",
        "contentUrl":"https://pauldambra.dev/images/cardboard.jpg",
        "url":"https://pauldambra.dev",
        "height":"450",
        "width":"1000"
     },
     "mainEntityOfPage":{
        "@type":"WebPage",
        "@id":"https://pauldambra.dev/2013/11/astronomical-database-identfier.html"
     },
     "articleBody":"I  dealt  with  an  unusual  requirement  over  the  last  few  days.  And  wish  I'd  understood  some  of  the  more  unusual  ways  that  big  numbers  are  handled  in  C#,  Entity  Framework,  MS  SQL  and  Oracle\n\n\n\nThat  requirement  came  about  in  the  development  of  an  App  that  will  act  as  an  API  for  a  bunch  of  sales  data.  The  data  is  provided  by  another  3rd  party  exported  from  their  Oracle  database.\n\nThat  data  ultimately  ends  up  in  pretty  graphs  on  an  iPad.\n\nWhen  I  received  the  first  set  of  demo  data  I  noticed  both  negative  IDs  and  9  digit  ids.\n\nThis  immediately  made  me  worry  about  whether  we  had  the  right  data  formats  (everyone  worries  about  data  formats,  right?)  and  I  asked  the  question.\n\nIt  turns  out  that  the  DB  schema  that  the  data  is  ultimately  sourced  from  has  the  ID  column  defined  as  NUMBER(38).\n\nI've  never  really  used  Oracle  so  I  had  to  dig  around  to  discover  that  a  NUMBER(38)  field  can  hold  99999999999999999999999999999999999999x10125  as  its  maximum  value\n\nOK,  that's  a  big  number.  Let's  put  it  into  context  -  the  ESA  estimates  there  are  something  like  1022 to  1024  stars  in  the  known  universe\n\nThese  IDs  are  used  in  the  MS  SQL  DB  Schema  that  we're  importing  into  so  I  can't  ignore  the  possibility  of  an  ID  coming  in  with  this  massive  value.  So  there're  three  distinct  problems  here…\n\n\n    How  do  I  represent  these  numbers  in  .Net  (C#  4.5  to  be  precise)\n    How  do  I  have  Entity  Framework  6  map  these  potentially  massive  IDs\n    How  do  I  represent  these  numbers  in  the  schema\n\n\nRepresenting  a  Vigintillion  in  Dot  Net\n\nA  quick  journey  to  MSDN  and  we  can  see  that  if  we  restrict  ourselves  to  integral  types  then  we  have  int  and  long…  In  short  one  of  those  will  hold  a  lot,  lot  less  than  NUMBER(38)  and  the  other  a  lot  less.\n\nAll  is  not  lost.  Since  .Net  4  we  have  had  access  to  BigInteger  which  allows  for  arbitrarily  large  numbers.\n\nOK,  so  we  can  actually  import  the  number  into  memory…  that's  a  start\n\nUsing  BigDecimal  as  an  ID  in  EF6\n\nLet's  fire  up  an  EF  project,  create  an  entity  model  with  a  BigInteger  ID,  and  add  a  DbSet  for  that  model  to  a  DbContext:\n\n\n\nHaving  an  integral  type  ID  at  this  point  and  running  Enable-Migrations  from  the  console  would  work  without  complaint  but  with  BigInteger  as  the  Id  an  exception  is  thrown…\n\nSystem.Data.Entity.ModelConfiguration.ModelValidationException:  One  or  more  validation  errors  were  detected  during  model  generation:\n\nHugeNumbers.Proton:  :  EntityType  'Proton'  has  no  key  defined.\n\nDefine  the  key  for  this  EntityType.\n\nProtons:  EntityType:  EntitySet  'Protons'  is  based  on  type  'Proton'  that  has  no  keys  defined.\n\n\nAdding  the  [Key]  data  attribute  doesn't  help.\n\nHow  about  fangling  the  ModelBuilder  directly?\n\n\n\nProgress!  Kind  of  :\n\nThe  property  'Id'  cannot  be  used  as  a  key  property  on  the  entity  'HugeNumbers.Proton'  because  the  property  type  is  not  a  valid  key  type.  Only  scalar  types,  string  and  byte[]  are  supported  key  types.\n\n\nA  negative  result  is  still  a  result.  So  this  is  definitely  progress!  The  scalar  types  in  SQL  include  numeric  which  can  hold  38  digits.  Huzzah!  And  answers  the  question  of  how  to  represent  the  ID  in  the  database.\n\nSo  can  we  have  a  numeric  ID  in  EF?!\n\nSo  long  as  we  can  define  a  value  type  key  we  can  have  numeric  in  the  DB.  Ta  da!\n\n\n\nWe  can  enable  migrations  and  then  generate  one:\n\n\n\nWrong  :\n\nDecimal  has  the  largest  precision  of  the  .Net  value  types  and  \"only\"  offers  28-29  significant  digits\n\nIs  this  peculiar  to  Entity  Framework?\n\nThe  NHibernate  docs  say\n\n\n    Any  integral  property  type  is  thus  supported.\n\n\nso  unless  there  is  some  funkiness  possible  with  NHibernate  (which  I've  never  used  in  anger)  then  I'm  guessing  they've  made  a  similar  design  decision  to  the  EF  team.  And  it  wouldn't  be  possible  there  either…\n\nIn  conclusion\n\n\n\nEntity  Framework  is  not  yet  ready  for  storing  an  identifier  for  every  proton  in  the  universe  and  if  you  might  want  to  be  storing  38  digit  identifiers  (a  phrase  which  I'm  assured  by  my  five-year  old  daughter  actually  kills  int32.MaxValue  fairies  every  time  it  is  uttered)  then  you  aren't  going  to  be  using  Entity  Framework  and  I'd  guess  you  aren't  going  to  be  having  a  good  time.\n\nAnd  straight  from  the  Magic  Unicorns  mouth\n\n\n\t@pauldambra  As  you  concluded,  it's  not  possible  to  map  BigInt  with  EF.  Easiest  solution  is  probably  to  bypass  EF  for  that  data.\n\n        —  Entity  Framework  (@efmagicunicorns)  November  22,  2013\n\n\n"
  }
</script>

<article>
<header class="flex flex-col border-b-black border-b-2 bg-white text-black">
  <div class="heading">
    <div class="date">Fri Nov 22 2013</div>
    <h1 class="title leading-10 pt-2 mb-0 mt-1">Astronomical Database Identfier</h1>
  </div>
  <div class="meta flex-grow flex flex-row">
    <div class="share-this flex self-end space-x-2">
      <a
        id="facebook-share-link"
        class="social-share"
        target="_blank"
        rel="noopener"
        href="https://www.facebook.com/dialog/share?app_id=305449093152216&href=https://pauldambra.dev/2013/11/astronomical-database-identfier.html"
      >
        <img
          class="w-8"
          src="/images/facebook-black-32.png"
          alt="share on facebook"
          width="32"
          height="32"
        />
      </a>
      <a
        id="twitter-share-link"
        class="social-share"
        target="_blank"
        rel="noopener"
        href="https://twitter.com/intent/tweet?text=Astronomical+Database+Identfier&via=pauldambra&url=https://pauldambra.dev/2013/11/astronomical-database-identfier.html"
      >
        <img
          class="w-8"
          src="/images/twitter-black-32.png"
          alt="share on twitter"
          width="32"
          height="32"
        />
      </a>
    </div>
    <div class="more-like-this text-right content-end flex-grow">
      <a
        class="post-metadata"
        href="/categories.html#databases"
      >
        in: databases
      </a>
      <div>
<span class="text-slate-500">
  <img class="w-6 h-6 inline-block" src="/images/tag.svg" alt="tag-icon" />
  <a class="no-underline hover:underline" href="/tags.html#entity-framework">
    entity-framework
  </a>
</span>

<span class="text-slate-500">
  <img class="w-6 h-6 inline-block" src="/images/tag.svg" alt="tag-icon" />
  <a class="no-underline hover:underline" href="/tags.html#oracle">
    oracle
  </a>
</span>

<span class="text-slate-500">
  <img class="w-6 h-6 inline-block" src="/images/tag.svg" alt="tag-icon" />
  <a class="no-underline hover:underline" href="/tags.html#wat">
    wat
  </a>
</span>

<span class="text-slate-500">
  <img class="w-6 h-6 inline-block" src="/images/tag.svg" alt="tag-icon" />
  <a class="no-underline hover:underline" href="/tags.html#rant">
    rant
  </a>
</span>

</div>
    </div>
  </div>
</header>

	<div class="post">
		<p>I dealt with an unusual requirement over the last few days. And wish I'd understood some of the more unusual ways that big numbers are handled in C#, Entity Framework, MS SQL and Oracle</p>

<!--more-->

<p>That requirement came about in the development of an App that will act as an API for a bunch of sales data. The data is provided by another 3rd party exported from their Oracle database.</p>

<p>That data ultimately ends up in pretty graphs on an iPad.</p>

<p>When I received the first set of demo data I noticed both negative IDs and 9 digit ids.</p>

<p>This immediately made me worry about whether we had the right data formats (everyone worries about data formats, right?) and I asked the question.</p>

<p>It turns out that the DB schema that the data is ultimately sourced from has the ID column defined as NUMBER(38).</p>

<p>I've never really used Oracle so I had to dig around to discover that <a href="http://docs.oracle.com/cd/B19306_01/server.102/b14237/limits001.htm">a NUMBER(38) field can hold 99999999999999999999999999999999999999x10<sup>125</sup> as its maximum value</a></p>

<p>OK, that's a big number. Let's put it into context - <a href="https://www.esa.int/Our_Activities/Space_Science/Herschel/How_many_stars_are_there_in_the_Universe">the ESA estimates there are something like 10<sup>22</sup> to 10<sup>24 </sup> stars in the known universe</a></p>

<p>These IDs are used in the MS SQL DB Schema that we're importing into so I can't ignore the possibility of an ID coming in with this massive value. So there're three distinct problems here…</p>

<ol>
  <li>How do I represent these numbers in .Net (C# 4.5 to be precise)</li>
  <li>How do I have Entity Framework 6 map these potentially massive IDs</li>
  <li>How do I represent these numbers in the schema</li>
</ol>

<h2 id="representing-a-vigintillion-in-dot-net">Representing a Vigintillion in Dot Net</h2>

<p><a href="http://msdn.microsoft.com/en-us/library/exx3b86w(v=vs.110).aspx">A quick journey to MSDN</a> and we can see that if we restrict ourselves to integral types then we have int and long… In short one of those will hold a lot, lot less than NUMBER(38) and the other a lot less.</p>

<p>All is not lost. Since .Net 4 we have had access to <a href="http://msdn.microsoft.com/en-us/library/system.numerics.biginteger(v=vs.110).aspx">BigInteger</a> which allows for arbitrarily large numbers.</p>

<p>OK, so we can actually import the number into memory… that's a start</p>

<h3 id="using-bigdecimal-as-an-id-in-ef6">Using BigDecimal as an ID in EF6</h3>

<p>Let's fire up an EF project, create an entity model with a BigInteger ID, and add a DbSet for that model to a DbContext:</p>

<p><img src="http://4.bp.blogspot.com/-PgeRsO_R89w/Uo-zpg99w-I/AAAAAAAAJTk/8CyZmhvxdCw/s640/HugeNumbers.PNG" alt="huge numbers code" loading="lazy" /></p>

<p>Having an integral type ID at this point and running Enable-Migrations from the console would work without complaint but with BigInteger as the Id an exception is thrown…</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>System.Data.Entity.ModelConfiguration.ModelValidationException: One or more validation errors were detected during model generation:

HugeNumbers.Proton: : EntityType 'Proton' has no key defined.

Define the key for this EntityType.

Protons: EntityType: EntitySet 'Protons' is based on type 'Proton' that has no keys defined.
</code></pre></div></div>

<p>Adding the [Key] data attribute doesn't help.</p>

<p>How about fangling the ModelBuilder directly?</p>

<p><img src="http://1.bp.blogspot.com/-Sy-WWyCcbWg/Uo-1qZFYLQI/AAAAAAAAJTw/kaI76AZC15s/s1600/proton2.PNG" alt="huge numbers more code" loading="lazy" /></p>

<p>Progress! Kind of :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The property 'Id' cannot be used as a key property on the entity 'HugeNumbers.Proton' because the property type is not a valid key type. Only scalar types, string and byte[] are supported key types.
</code></pre></div></div>

<p>A negative result is still a result. So this is definitely progress! The <a href="https://docs.microsoft.com/en-us/sql/t-sql/data-types/decimal-and-numeric-transact-sql?view=sql-server-ver15">scalar types in SQL</a> include <a href="http://msdn.microsoft.com/en-us/library/ms187746.aspx">numeric</a> which can hold 38 digits. Huzzah! And answers the question of how to represent the ID in the database.</p>

<h4 id="so-can-we-have-a-numeric-id-in-ef">So can we have a numeric ID in EF?!</h4>

<p>So long as we can define a value type key we can have numeric in the DB. Ta da!</p>

<p><img src="http://2.bp.blogspot.com/-5kh5vIIvp0w/Uo-7LImoKqI/AAAAAAAAJUA/i4OdUD5Coxo/s1600/Capture3.PNG" alt="huge numbers even more code" loading="lazy" /></p>

<p>We can enable migrations and then generate one:</p>

<p><img src="http://1.bp.blogspot.com/-KelcMu1mi6w/Uo-7cv3auqI/AAAAAAAAJUI/lVSpjAvszNU/s1600/Capture4.PNG" alt="huge numbers even more code" loading="lazy" /></p>

<p>Wrong :</p>

<p>Decimal has the largest precision of the .Net value types and <a href="http://msdn.microsoft.com/en-us/library/364x0z75(v=vs.110).aspx">"only" offers 28-29 significant digits</a></p>

<h3 id="is-this-peculiar-to-entity-framework">Is this peculiar to Entity Framework?</h3>

<p><a href="https://nhibernate.info/doc/nhibernate-reference/mapping.html">The NHibernate docs</a> say</p>

<blockquote>
  <p>Any integral property type is thus supported.</p>
</blockquote>

<p>so unless there is some funkiness possible with NHibernate (which I've never used in anger) then I'm guessing they've made a similar design decision to the EF team. And it wouldn't be possible there either…</p>

<h3 id="in-conclusion">In conclusion</h3>

<!--alex ignore daughter-son fairies --->

<p>Entity Framework is not yet ready for storing an identifier for every proton in the universe and if you might want to be storing 38 digit identifiers (a phrase which I'm assured by my five-year old daughter actually kills <code class="language-plaintext highlighter-rouge">int32.MaxValue</code> fairies every time it is uttered) then you aren't going to be using Entity Framework and I'd guess you aren't going to be having a good time.</p>

<h3 id="and-straight-from-the-magic-unicorns-mouth">And straight from the Magic Unicorns mouth</h3>

<div class="tweet-wrapper">
	<blockquote class="twitter-tweet" lang="en"><a href="https://twitter.com/pauldambra">@pauldambra</a> As you concluded, it's not possible to map BigInt with EF. Easiest solution is probably to bypass EF for that data.

    — Entity Framework (@efmagicunicorns) <a href="https://twitter.com/efmagicunicorns/statuses/403996143677235200">November 22, 2013</a></blockquote><script async="" charset="utf-8" src="//platform.twitter.com/widgets.js"></script>

</div>

	</div>
	<div class="mt-8">
  
  <h1>More like this...</h1>
   
  <div class="grid grid-cols-3 gap-4"></div> 
  
</div>

</article>
    </main>
    <footer class="w-full h-4 bg-black text-white py-8 px-4">
  <a class="no-underline text-white" href="https://pauldambra.dev/feed.xml">
    <img class="inline w-6 h-6" src="/images/rss.svg" alt="the rss feed" />
    <span>Subscribe to RSS feed</span>
  </a>
</footer>
 
    <script>
      var tsl = document.getElementById("twitter-share-link");
      tsl.addEventListener("click", function () {
        ga("send", {
          hitType: "social",
          socialNetwork: "twitter",
          socialAction: "tweet",
          socialTarget: "https://pauldambra.dev/2013/11/astronomical-database-identfier.html",
        });
      });

      var fsl = document.getElementById("facebook-share-link");
      fsl.addEventListener("click", function () {
        ga("send", {
          hitType: "social",
          socialNetwork: "facebook",
          socialAction: "share",
          socialTarget: "https://pauldambra.dev/2013/11/astronomical-database-identfier.html",
        });
      });
    </script>
    

    <script defer src="/register-service-worker.js"></script>

    <link
      href="https://fonts.googleapis.com/css?family=Khula&display=swap"
      rel="stylesheet"
    />
  </body>
</html>
