<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">

    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="/images/icons/icon-152x152.png">
    <!-- theme-color defines the top bar color-->
    <meta name="theme-color" content="#575757"/>
    <meta http-equiv="X-Content-Security-Policy" content="default-src 'self'; script-src 'report-sample' 'self' https://app.posthog.com/static/array.js https://www.googletagmanager.com/gtag/js; style-src 'report-sample' 'self' https://fonts.googleapis.com; object-src 'none'; base-uri 'self'; connect-src 'self' https://app.posthog.com; font-src 'self'; frame-src 'self'; img-src 'self'; manifest-src 'self'; media-src 'self'; report-uri https://pauldambra.report-uri.com/r/d/csp/enforce; worker-src 'self';" />
    <!-- Add to home screen for Safari on iOS-->
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
    <meta name="apple-mobile-web-app-title" content="MiRaNo"/>
    <link rel="apple-touch-icon" href="/images/icons/icon-152x152.png"/>

    <!-- Add to home screen for Windows-->
    <meta name="msapplication-TileImage" content="/images/icons/icon-152x152.png"/>
    <meta name="msapplication-TileColor" content="#575757"/>

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Reactotype Part 2</title>
    <link rel="canonical" href="https://pauldambra.dev/reactotype/part-two.html" />
    <meta property="og:url"          content="https://pauldambra.dev/reactotype/part-two.html" />
    <meta property="og:type"         content="article" />
    <meta property="og:title"        content="Reactotype Part 2" />
    <meta property="og:description"  content="exploring ReactJS" />
    <meta property="og:image"        content="https://pauldambra.dev/images/cardboard.jpg" />
    <meta name="twitter:creator" content="@pauldambra" />
    <meta property="fb:app_id"       content="1029758320473951" />

    <meta name="viewport" content="width=device-width">
    <meta name="description" content="exploring ReactJS">
    <meta property="fb:pages" content="1029758320473951" />
    <link rel="alternate" type="application/rss+xml" title="Mindless Rambling Nonsense" href="https://pauldambra.dev/feed.xml">
    <link rel="shortcut icon" href="/favicon.ico" />

    <link rel="prefetch" href="/images/cardboard.jpg">

    <style>
      .highlight .hll { background-color: #ffffcc }
.highlight  { background: #f0f3f3; }
.highlight .c { color: #0099FF; font-style: italic } /* Comment */
.highlight .err { color: #AA0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #006699; font-weight: bold } /* Keyword */
.highlight .o { color: #555555 } /* Operator */
.highlight .ch { color: #0099FF; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #0099FF; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #009999 } /* Comment.Preproc */
.highlight .cpf { color: #0099FF; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #0099FF; font-style: italic } /* Comment.Single */
.highlight .cs { color: #0099FF; font-weight: bold; font-style: italic } /* Comment.Special */
.highlight .gd { background-color: #FFCCCC; border: 1px solid #CC0000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #003300; font-weight: bold } /* Generic.Heading */
.highlight .gi { background-color: #CCFFCC; border: 1px solid #00CC00 } /* Generic.Inserted */
.highlight .go { color: #AAAAAA } /* Generic.Output */
.highlight .gp { color: #000099; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #003300; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #99CC66 } /* Generic.Traceback */
.highlight .kc { color: #006699; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #006699; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #006699; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #006699 } /* Keyword.Pseudo */
.highlight .kr { color: #006699; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #007788; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #FF6600 } /* Literal.Number */
.highlight .s { color: #CC3300 } /* Literal.String */
.highlight .na { color: #330099 } /* Name.Attribute */
.highlight .nb { color: #336666 } /* Name.Builtin */
.highlight .nc { color: #00AA88; font-weight: bold } /* Name.Class */
.highlight .no { color: #336600 } /* Name.Constant */
.highlight .nd { color: #9999FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #CC0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #CC00FF } /* Name.Function */
.highlight .nl { color: #9999FF } /* Name.Label */
.highlight .nn { color: #00CCFF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #330099; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #003333 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #FF6600 } /* Literal.Number.Bin */
.highlight .mf { color: #FF6600 } /* Literal.Number.Float */
.highlight .mh { color: #FF6600 } /* Literal.Number.Hex */
.highlight .mi { color: #FF6600 } /* Literal.Number.Integer */
.highlight .mo { color: #FF6600 } /* Literal.Number.Oct */
.highlight .sa { color: #CC3300 } /* Literal.String.Affix */
.highlight .sb { color: #CC3300 } /* Literal.String.Backtick */
.highlight .sc { color: #CC3300 } /* Literal.String.Char */
.highlight .dl { color: #CC3300 } /* Literal.String.Delimiter */
.highlight .sd { color: #CC3300; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #CC3300 } /* Literal.String.Double */
.highlight .se { color: #CC3300; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #CC3300 } /* Literal.String.Heredoc */
.highlight .si { color: #AA0000 } /* Literal.String.Interpol */
.highlight .sx { color: #CC3300 } /* Literal.String.Other */
.highlight .sr { color: #33AAAA } /* Literal.String.Regex */
.highlight .s1 { color: #CC3300 } /* Literal.String.Single */
.highlight .ss { color: #FFCC33 } /* Literal.String.Symbol */
.highlight .bp { color: #336666 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #CC00FF } /* Name.Function.Magic */
.highlight .vc { color: #003333 } /* Name.Variable.Class */
.highlight .vg { color: #003333 } /* Name.Variable.Global */
.highlight .vi { color: #003333 } /* Name.Variable.Instance */
.highlight .vm { color: #003333 } /* Name.Variable.Magic */
.highlight .il { color: #FF6600 } /* Literal.Number.Integer.Long */

      
      html { height: 100%; font-size: 20px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); }

html * { box-sizing: border-box; }

body { font-family: "Khula", sans-serif; font-size: 1em; min-height: 100%; display: flex; flex-direction: column; margin: 0; line-height: 1.42857143; }

main { background-color: #fff; padding: 10px 5px; /* flex: 1; would be enough but it looks bad in IE */ flex: 1 1 auto; width: 94%; margin: auto; }

h1 { font-size: 2em; }

h2 { font-size: 1.5em; }

h3 .post-metadata { font-size: 1.2em; }

h3.tag-list { font-size: 1.2em; }

hr { clear: both; }

p { word-wrap: break-word; }

a { color: #000; text-decoration: underline; }

a:visited { color: #000; }

a:hover { color: #000; text-decoration: underline; }

li { margin-left: 0.5em; }

.pagination { text-align: center; word-spacing: 0.75em; }

.pagination a { text-decoration: none; }

.pagination a:hover { text-decoration: underline; }

article header { display: flex; flex-direction: column; border-bottom: #000 solid 2px; background-color: #fff; color: #000; }

article header .heading { flex: 3 0 auto; }

article header .meta { flex: 1 0 auto; display: flex; flex-direction: row; }

@media (max-width: 450px) { article header .meta { flex-direction: column; } }

article header .meta .more-like-this { text-align: right; align-content: flex-end; flex: 3 0 auto; }

article header .meta .post-category { float: none; }

article header .meta .share-this { display: flex; align-self: flex-end; }

article header .meta .share-this a { margin-right: 5px; }

article header .meta .share-this img { width: 32px; height: 32px; }

article #title { line-height: 75px; padding-top: 10px; }

article h1 { -webkit-margin-after: 0; -webkit-margin-before: 5px; margin-bottom: 0; margin-top: 5px; }

blockquote { padding: 5px 10px; margin: 0 0 20px; border-left: 5px solid #eee; }

header { display: flex; flex-direction: column; background-color: #222; color: #fff; padding: 5px 15px 10px 15px; }

header nav, header .top { background-color: rgba(0, 0, 0, 0.3); box-shadow: 0 0 0.5em 0.5em rgba(0, 0, 0, 0.3); padding: 0.5em 1em; }

header nav a + a { margin-left: 1em; }

header .top { display: flex; flex-direction: row; }

@media (max-width: 550px) { header .top { flex-direction: column; } header .top .name { margin-top: 1em; } }

header .separator { flex-grow: 1; }

header.hero { background-image: url("/images/cardboard.jpg"); }

@media (max-width: 600px) { header.hero { background-position: -400px -23px; } }

@media (max-width: 778px) { header.hero { height: 370px; } }

@media (min-width: 778px) { header.hero { height: 437px; } }

@media (min-width: 984px) { header.hero { background-size: 100%; } }

@media (min-width: 1440px) { header.hero { height: 600px; } }

@media (max-height: 320px) { header.hero { height: 250px; } }

header.hero a { color: #fff; text-decoration: underline; }

header.hero a:visited { color: #fff; }

header.hero a:hover { color: #fff; text-decoration: underline; }

header a { color: #aaa; text-decoration: underline; }

header a:visited { color: #aaa; }

header a:hover { color: #aaa; text-decoration: underline; }

header .title a { text-decoration: none; }

@media (min-width: 550px) { header .title { font-size: 150%; font-weight: bold; } }

header .name { display: flex; align-items: flex-end; justify-content: flex-start; flex-direction: column; }

@media (max-width: 750px) { header .name p { justify-content: flex-end; } }

header .name .row { display: flex; align-items: center; }

header .name .row div { margin-right: 15px; }

header .name .row a { height: 32px; }

header p { margin: 0; word-wrap: break-word; }

@media screen and (max-width: 500px) { ul { padding: 0; } }

.excerpt h1 { overflow: hidden; text-overflow: ellipsis; }

.excerpt .series { display: none; }

.categories-list li { list-style: none; margin: 0.2em; }

.short { height: 100px !important; }

.tag-list { font-weight: normal; }

.tag-list li { list-style: none; margin: 0.2em; }

.tag-list .post-category { float: none; }

.tag-list h3 a { color: #000; text-decoration: none; }

.tag-list h3 a:visited { color: #000; }

.tag-list h3 a:hover { color: #000; text-decoration: underline; }

.tag-list a { color: #aaa; text-decoration: none; }

.tag-list a:visited { color: #aaa; }

.tag-list a:hover { color: #aaa; text-decoration: underline; }

.link-list .post-category { float: left; padding: 5px; }

.category-link { font-weight: normal; }

.category-link a { color: #000; text-decoration: none; }

.category-link a:visited { color: #000; }

.category-link a:hover { color: #000; text-decoration: underline; }

.post-metadata { color: #575757; display: inline-block; padding: 1px 3px; }

.post-metadata a { color: #575757; text-decoration: none; }

.post-metadata a:visited { color: #575757; }

.post-metadata a:hover { color: #575757; text-decoration: underline; }

.post-category { float: right; }

.post-category img { fill: #575757; width: 24px; height: 24px; display: inline-block; }

.post-item { -moz-transition: 0.25s; -ms-transition: 0.25s; -o-transition: 0.25s; -webkit-transition: 0.25s; margin-bottom: 20px; transition: 0.25s; display: flex; flex-direction: column; flex: 4 0 auto; }

.post-item:hover { background-color: rgba(245, 245, 245, 0.7); border-radius: 5px; }

.post-item .metadata .post-category { text-align: right; }

img { display: block; max-width: 1000px; vertical-align: middle; width: 100%; margin: auto; }

aside { border-left: 1px solid darkslateblue; color: darkslateblue; margin-bottom: 1em; margin-left: 2em; padding-left: 0.5em; }

aside.series { border-left: none; margin: 0 0 1.5em 0; }

aside.series h1 { font-size: 1em; }

aside.series .links { display: flex; }

aside.series .links .previous { text-align: left; flex: 1 0 auto; }

aside.series .links .next { text-align: right; flex: 1 0 auto; }

.posts { list-style-type: none; margin-bottom: 2em; padding: 0; }

.posts li { line-height: 1.75em; }

footer { padding: 5px 15px; margin: 0 auto; width: 100%; background-color: #000; color: #fff; min-height: 2em; overflow: hidden; height: 30px; }

footer a, footer a:visited, footer a:hover { color: #fff; line-height: 25px; vertical-align: bottom; text-decoration: none; }

footer a img, footer a:visited img, footer a:hover img { width: 25px; height: 25px; line-height: 25px; vertical-align: sub; text-decoration: none; display: inline; }

.paged-weeknotes a { text-decoration: none; }

.further-reading { margin-top: 60px; }

.further-reading a { text-decoration: none; }

.further-reading .article-tile { display: inline-block; width: 30%; margin-right: 1%; border: 1px solid #aaa; padding: 5px; min-height: 10em; text-overflow: ellipsis; vertical-align: top; position: relative; }

@media screen and (max-width: 425px) { .further-reading .article-tile { width: 100%; margin-bottom: 1%; } }

.further-reading .article-tile small { bottom: 5px; position: absolute; right: 5px; }

.highlight { overflow-x: scroll; }

    </style>
    <meta name="msvalidate.01" content="54691C3C7B863CEE60F0305D6EDFF7A8" />
    <meta name="google-site-verification" content="hLKEdujpXNQ9PSZWEcQkwxCgL2z1tWxVedeaUmttH7c" />
    <script>
  !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
  posthog.init('phc_DumQNjXoXRQpyaus5OM861c3BEYtwwKyzVTNmPs1XIt',{api_host:'https://app.posthog.com', _capture_performance: true, debug: true, autocapture: true, capture_pageview: true, disable_session_recording: false })
</script> 
  </head>
  <body>
    <header class="hero" role="banner">
	<div class="top">
		<div class="title">
			<a href="/">Mindless Rambling Nonsense</a>
		</div>
		<div class="separator"></div>
		<div class="name">
			<div class="row">
				<div>Paul D'Ambra</div>
					<a href="https://github.com/pauldambra" rel="noopener">
						<img src="/images/GitHub-Mark-Light-32px.png" alt="pauldambra on github" width="32" height="32">
					</a>
			</div>
			<div class="row">
				<div>Fangler</div>
					<a href="https://twitter.com/pauldambra" rel="noopener">
						<img src="/images/twitter-32.png" alt="pauldambra on twitter" width="32" height="32">
					</a>
			</div>
		</div>
	</div>
	<div class="separator"></div>
	<div class="bottom">
		<nav role="navigation">
			<a href="/">Blog Posts</a>
			<a href="/weeknotes.html">Week Notes</a>
		</nav>
	</div>
</header>

    <main role="main">
      

<script type="application/ld+json">
{  
   "@context":"http://schema.org",
   "@type":"BlogPosting",
   "headline":"Reactotype Part 2",
   "genre":"",
   "keywords":"",
   "wordCount":"2259",
   "url":"https://pauldambra.dev/reactotype/part-two.html",
   "datePublished":"2015-02-19",
   "author":{  
      "@type":"Person",
      "name":"Paul D'Ambra",
      "sameAs":[  
        "https://twitter.com/pauldambra",
        "https://github.com/pauldambra",
        "https://plus.google.com/u/0/+PaulDAmbraPlus"
      ]
   },
   "publisher":{  
"@type": "Organization",
    "name": "Paul D'Ambra",
    "sameAs": [
        "https://twitter.com/pauldambra",
        "https://github.com/pauldambra",
        "https://plus.google.com/u/0/+PaulDAmbraPlus"
    ],
    "logo": {
      "@type": "ImageObject",
      "contentUrl": "https://pauldambra.dev/images/logo.png",
        "url": "https://pauldambra.dev"
    }
   },
   "image":{  
      "@type":"ImageObject",
      "contentUrl":"https://pauldambra.dev/images/cardboard.jpg",
      "url":"https://pauldambra.dev",
      "height":"450",
      "width":"1000"
   },
   "mainEntityOfPage":{  
      "@type":"WebPage",
      "@id":"https://pauldambra.dev/reactotype/part-two.html"
   },
   "articleBody":"\nI  posted  about  my  impressions  of  working  with  React  slowly  building  an  HTML  table  and  banging  on  about  it.  I  ended  that  post  with  one  of  the  more  memorable  cliff-hangers  in  recent  time.\n\n\n    Sorting  and  Filtering  the  Table\n\n    That  we  will  leave  till  part  two…  because  I  introduced  a  relatively  artifical  constraint  that  I  didn't  want  the  filtering  control  to  be  a  part  of  the  table.\n\n    Imagine  that  there  will  be  many  tables  with  the  same  filter.  I  don't  want  to  bind  the  filter  to  any  one  table  or  insist  that  every  table  has  it.\n\n    At  first  I  expected  that  it  would  force  me  to  understand  React's  components  and  how  to  compose  them…  instead  I  stumbled  on  something  really  cool  #cliffhanger\n\n\nExciting!  Right?\n\nI  want  to  add  a  filter  control  and  I  don't  want  it  to  be  bound  to  a  particular  table  so  that  it  can  be  re-used.\n\n\n\nSo,  having  squeezed  the  table  to  make  space  for  a  column  for  filter  controls  I  needed  to  do  two  things\n\n\n    Add  the  filter  controls\n    Make  them  affect  the  table\n\n\n\n\nAdding  the  filter  controls\n\nOnce  I'd  made  a  static  HTML  version  of  the  filter  controls  and  knew  that  I  was  aiming  for  a  number  input  for  the  earliest  year  to  display  and  one  for  the  latest.\n\n&lt;div  className=\"col-xs-12\"&gt;\n\t&lt;div  className=\"form-group\"&gt;\n\t\t&lt;label  htmlFor=\"earliest\"&gt;Earliest&lt;/label&gt;\n\t\t&lt;input  type=\"number\"  \n\t\t\t      name=\"earliest\"\n\t\t\t      className=\"form-control\"  /&gt;\n\t&lt;/div&gt;\n\t&lt;div  className=\"form-group\"&gt;\n\t\t&lt;label  htmlFor=\"latest\"&gt;Latest&lt;/label&gt;\n\t\t&lt;input  type=\"number\"  \n\t\t\t      name=\"latest\"  \n\t\t\t      className=\"form-control\"  /&gt;\n\t&lt;/div&gt;\n&lt;/div&gt;\n\n\nCopying  what  I  already  had  to  turn  this  into  a  React  component  was  a  very  short  job.  And  then  I  moved  onto  a  little  research  to  see  what  approaches  there  were  to  solve  my  problem  and  I  stumbled  on  a  JS  pub/sub  library  called  postal.js.\n\n\n    What  is  it?\n\n\n\n    Postal.js  is  an  in-memory  message  bus  -  very  loosely  inspired  by  AMQP  -  written  in  JavaScript.  Postal.js  runs  in  the  browser,  or  on  the  server  using  node.js.  It  takes  the  familiar  \"eventing-style\"  paradigm  (of  which  most  JavaScript  developers  are  familiar)  and  extends  it  by  providing  \"broker\"  and  subscriber  implementations  which  are  more  sophisticated  than  what  you  typically  find  in  event  emitting/aggregation.\n\n\n/**  @jsx  React.DOM  */\n'use  strict';\n\nvar  React  =  window.React  =  require('react');\nvar  postal  =  window.postal  =  require('postal');\n\nvar  FilterBox  =  React.createClass({\n        getInitialState:  function()  {\n                return  {\n                        earliest:  this.props.initialEarliest,\n                        latest:  this.props.initialLatest\n                };\n        },\n        handleEarliestChange:  function(event)  {\n        \tthis.setState({earliest:  parseInt(event.target.value,  10)},  function()  {\n        \t\tpostal.publish({\n        \t\t\tchannel:  'filters',\n        \t\t\ttopic:  'year.bounds.change',  \n        \t\t\tdata:  this.state\n        \t\t});\n        \t});\n        },\n        handleLatestChange:  function(event)  {\n        \tthis.setState({latest:  parseInt(event.target.value,  10)},  function()  {\n        \t\tpostal.publish({\n        \t\t\tchannel:  'filters',\n        \t\t\ttopic:  'year.bounds.change',  \n        \t\t\tdata:  this.state\n        \t\t});\n        \t});\n        },\n        render:  function()  {\n                return  (\n                \t&lt;div  className=\"col-xs-12\"&gt;\n                \t\t&lt;div  className=\"form-group\"&gt;\n                \t\t\t&lt;label  htmlFor=\"earliest\"&gt;Earliest&lt;/label&gt;\n                \t\t\t&lt;input  type=\"number\"  \n                \t\t\t\t      name=\"earliest\"\n                \t\t\t\t      className=\"form-control\"\n                \t\t\t\t      defaultValue={this.state.earliest}\n                \t\t\t\t      min={this.props.initialEarliest}  \n                \t\t\t\t      max={this.props.initialLatest}\n                \t\t\t\t      onChange={this.handleEarliestChange}/&gt;\n                \t\t&lt;/div&gt;\n                \t\t&lt;div  className=\"form-group\"&gt;\n                \t\t\t&lt;label  htmlFor=\"latest\"&gt;Latest&lt;/label&gt;\n                \t\t\t&lt;input  type=\"number\"  \n                \t\t\t\t      name=\"latest\"  \n                \t\t\t\t      className=\"form-control\"\n                \t\t\t\t      defaultValue={this.state.latest}\n                \t\t\t\t      min={this.props.initialEarliest}  \n                \t\t\t\t      max={this.props.initialLatest}\n                \t\t\t\t      onChange={this.handleLatestChange}/&gt;\n                \t\t&lt;/div&gt;\n                \t&lt;/div&gt;\n                );\n        }\n});\n\nmodule.exports  =  FilterBox;\n\n\nWhat  do  we  have?\n\nRender\n\nrender:  function()  {\n        return  (\n        \t&lt;div  className=\"col-xs-12\"&gt;\n        \t\t&lt;div  className=\"form-group\"&gt;\n        \t\t\t&lt;label  htmlFor=\"earliest\"&gt;Earliest&lt;/label&gt;\n        \t\t\t&lt;input  type=\"number\"  \n        \t\t\t\t      name=\"earliest\"\n        \t\t\t\t      className=\"form-control\"\n        \t\t\t\t      defaultValue={this.state.earliest}\n        \t\t\t\t      min={this.props.initialEarliest}  \n        \t\t\t\t      max={this.props.initialLatest}\n        \t\t\t\t      onChange={this.handleEarliestChange}/&gt;\n        \t\t&lt;/div&gt;\n        \t\t&lt;div  className=\"form-group\"&gt;\n        \t\t\t&lt;label  htmlFor=\"latest\"&gt;Latest&lt;/label&gt;\n        \t\t\t&lt;input  type=\"number\"  \n        \t\t\t\t      name=\"latest\"  \n        \t\t\t\t      className=\"form-control\"\n        \t\t\t\t      defaultValue={this.state.latest}\n        \t\t\t\t      min={this.props.initialEarliest}  \n        \t\t\t\t      max={this.props.initialLatest}\n        \t\t\t\t      onChange={this.handleLatestChange}/&gt;\n        \t\t&lt;/div&gt;\n        \t&lt;/div&gt;\n        );\n}\n\n\nHere  we've  added  a  react  specific  attribute  defaultValue  to  set  the  starting  state  of  the  inputs,  added  min  and  max  validation  using  properties  passed  in  to  the  component  and  an  onChange  handler  specific  to  each  number  input.\n\nInitial  state\n\ngetInitialState:  function()  {\n        return  {\n                earliest:  this.props.initialEarliest,\n                latest:  this.props.initialLatest\n        };\n}\n\n\nHere  the  default  values  for  the  earliest  and  latest  state  are  set.\n\nEvent  Handlers\n\nThese  two  handlers  are  the  same  except  for  operating  on  a  different  property  of  the  state  object.\n\nYes,  yes,  remove  all  duplication.  But…  the  duplicate  methods  are  next  to  each  other  and  I've  half  a  mind  to  make  each  control  a  React  component  which  would  remove  this  duplication  so  why  do  that  work  twice.\n\n(I  got  all  excited  about  postal.js  and  wrote  this  post  before  finishing  the  component)\n\nhandleLatestChange:  function(event)  {\n\tthis.setState(\n\t\t{latest:  parseInt(event.target.value,  10)},  \n\t\tfunction()  {\n\t\t\tpostal.publish({\n\t\t\t\tchannel:  'filters',\n\t\t\t\ttopic:  'year.bounds.change',  \n\t\t\t\tdata:  this.state\n\t\t\t});\n\t\t}\n\t);\n}\n\n\nHere  when  an  event  is  received  the  function  calls  setState  on  the  React  component.  This  merges  the  object  provided  as  the  first  argument  with  the  component's  current  state.\n\nSince  that  update  doesn't  necessarily  occur  immediately  the  method  takes  a  callback  which  runs  after  the  update  completes.\n\nIn  this  case  the  callback  uses  postal  to  publish  a  message.  Postal  allows  you  to  hold  a  reference  to  a  channel  but  here  we're  using  a  convenience  method  that  allows  you  to  specify  the  channel.\n\npostal.publish({\n\tchannel:  'filters',\n\ttopic:  'year.bounds.change',  \n\tdata:  this.state\n});\n\n\nSo,  on  channel  'filters'  publish  a  message  with  the  topic  'year.bounds.change'  including  the  component's  state  as  the  message  data.\n\n(and  yes  the  first  thing  I  did  when  subscribing  was  type  in  one  of  those  magic  strings  incorrectly  so  there's  an  improvement  to  be  made  in  my  usage  there!)\n\nThis  gives  us  a  phenomenally  useless  pub/sub  mechanism  with  no  subscribers…\n\nSubscribing  is  even  harder\n\ncomponentWillMount:  function()  {\n\tpostal.subscribe({\n\t    channel:  \"filters\",\n\t    topic  :  \"year.bounds.change\",\n\t    callback:  function(data,  envelope)  {\n\t        this.filterData(data);\n\t    }\n\t}).context(this);\n\n\nPostal's  subscribe  helper  takes  an  object  with  the  same  properties  as  publish.  Here  for  messages  posted  to  a  given  channel  and  topic  it  will  call  the  provided  callback.\n\nThe  componentWillMount  method  of  the  React  component  is  called  once  before  initial  rendering  so  it  is  perfect  for  this  setup.\n\nMessy  Pay  Table  Reacting  to  Filtering\n\nvar  PayTable  =  React.createClass({\n        getInitialState:  function()  {\n                return  {\n                        sortDirection:  'descending',\n                        data:  this.props.payYears.sort(sortDescending)\n                };\n        },\n        preparePayData:  function(data,  options)  {\n                if  (options.yearBounds)  {\n                        data  =  data.filter(function(element)  {\n                                                return  element.year  &gt;=  options.yearBounds.earliest  \n                                                        &amp;&amp;  element.year  &lt;=  options.yearBounds.latest;\n                                        })\n                }\n                if  (options.sortDirection)  {\n                        data  =  data.sort(options.sortDirection==='descending'  \n                                                                ?  sortDescending\n                                                                :  sortAscending);\n                }\n                this.setState({data:  data});\n        },\n        sortData:  function()  {\n                this.setState({sortDirection:  this.state.sortDirection  ===  'descending'\n                                                                          ?  'ascending'\n                                                                          :  'descending'},  \n                                            function()  {\n                                                this.preparePayData(this.props.payYears,  this.state);\n                                            })\n        },\n        filterData:  function(filterBounds)  {\n                this.setState({yearBounds:  filterBounds},  function()  {\n                        this.preparePayData(this.props.payYears,  this.state);\n                });\n            },\n                componentWillMount:  function()  {\n                postal.subscribe({\n                    channel:  \"filters\",\n                    topic  :  \"year.bounds.change\",\n                    callback:  function(d,  e)  {\n                        this.filterData(d);\n                    }\n                }).context(this);\n            },\n        render:  function()  {\n                return  (\n                        &lt;table  className=\"table  table-striped\"&gt;\n                                &lt;thead&gt;\n                                        &lt;tr&gt;\n                                                &lt;th  onClick={this.sortData}\n                                                        className={this.state.sortDirection}&gt;\n                                                        Year\n                                                &lt;/th&gt;\n                                                &lt;th&gt;All&lt;/th&gt;\n                                                &lt;th&gt;Full-time&lt;/th&gt;\n                                                &lt;th&gt;Part-time&lt;/th&gt;\n                                        &lt;/tr&gt;\n                                &lt;/thead&gt;\n                                &lt;tbody&gt;\n                                        {this.state.data.map(function(payYear)  {\n                                            return  &lt;PayRow  key={payYear.year}  payYear={payYear}  /&gt;;\n                                        })}\n                                &lt;/tbody&gt;\n                        &lt;/table&gt;\n                );\n        }\n});\n\n\nPayTable  now  has  a  preparePayData  method  which  has  the  responsibility  of  taking  some  data  and  the  component's  current  state  and  setting  the  state's  data  property  correctly.\n\nNow  all  the  filterData  and  sortData  methods  need  to  do  is  update  state  and  then  call  preparePayData.\n\nThe  point  here  is  how  useful  it  was  to  use  postal.js  to  hook  these  two  components  together.  I  lurve  this!\n\n\n\nNext  Up\n\nA  little  bit  of  tidying  up  and  add  a  chart  view.  #holidaycode\n"
}
</script>
<article>
<header>
	<div class="heading">
		<div class="date">
			Thu Feb 19 2015
		</div>
		<h1 class="title">Reactotype Part 2</h1>
	</div>
	<div class="meta">
		<div class="share-this">
			<a id="facebook-share-link" 
			   class="social-share" 
			   target="_blank"
			   rel="noopener"
			   href="https://www.facebook.com/dialog/share?app_id=305449093152216&href=https://pauldambra.dev/reactotype/part-two.html">
				<img src="/images/facebook-black-32.png" alt="share on facebook" width="32" height="32">
			</a>
			<a id="twitter-share-link"
			   class="social-share" 
			   target="_blank"
			   rel="noopener"
			   href="https://twitter.com/intent/tweet?text=Reactotype+Part+2&via=pauldambra&url=https://pauldambra.dev/reactotype/part-two.html">
				<img src="/images/twitter-black-32.png" alt="share on twitter" width="32" height="32">
			</a>
		</div>
		<div class="more-like-this">
			<a class="post-metadata post-category"
				href="/categories.html#react">
				in: react
			</a>
			<div>
				
	<span class="post-category">
		<img src="/images/tag.svg" alt="tag-icon"/>
		<a class="post-metadata"
			href="/tags.html#learning">
			learning
		</a>
	</span>

	<span class="post-category">
		<img src="/images/tag.svg" alt="tag-icon"/>
		<a class="post-metadata"
			href="/tags.html#react">
			react
		</a>
	</span>

	<span class="post-category">
		<img src="/images/tag.svg" alt="tag-icon"/>
		<a class="post-metadata"
			href="/tags.html#js">
			js
		</a>
	</span>

	<span class="post-category">
		<img src="/images/tag.svg" alt="tag-icon"/>
		<a class="post-metadata"
			href="/tags.html#series">
			series
		</a>
	</span>

			</div>
		</div>
	</div>
</header>
	<div class="post">
		<!--alex ignore banging --->
<p>I posted about my <a href="/reactotype/part-one.html">impressions of working with React</a> slowly building an HTML table and banging on about it. I ended that post with one of the more memorable cliff-hangers in recent time.</p>

<blockquote>
  <h1 id="sorting-and-filtering-the-table">Sorting and Filtering the Table</h1>

  <p>That we will leave till part two… because I introduced a relatively artifical constraint that I didn't want the filtering control to be a part of the table.</p>

  <p>Imagine that there will be many tables with the same filter. I don't want to bind the filter to any one table or insist that every table has it.</p>

  <p>At first I expected that it would force me to understand React's components and how to compose them… instead I stumbled on something really cool #cliffhanger</p>
</blockquote>

<p>Exciting! Right?</p>

<p>I want to add a filter control and I don't want it to be bound to a particular table so that it can be re-used.</p>

<!--more-->

<p>So, having squeezed the table to make space for a column for filter controls I needed to do two things</p>

<ol>
  <li>Add the filter controls</li>
  <li>Make them affect the table</li>
</ol>

<p><img src="/images/reactotype_screenshot.png" alt="screenshot of the web page" loading="lazy" /></p>

<h1 id="adding-the-filter-controls">Adding the filter controls</h1>

<p>Once I'd made a static HTML version of the filter controls and knew that I was aiming for a number input for the earliest year to display and one for the latest.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">className=</span><span class="s">"col-xs-12"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;div</span> <span class="na">className=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;label</span> <span class="na">htmlFor=</span><span class="s">"earliest"</span><span class="nt">&gt;</span>Earliest<span class="nt">&lt;/label&gt;</span>
		<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"number"</span> 
			   <span class="na">name=</span><span class="s">"earliest"</span>
			   <span class="na">className=</span><span class="s">"form-control"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/div&gt;</span>
	<span class="nt">&lt;div</span> <span class="na">className=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;label</span> <span class="na">htmlFor=</span><span class="s">"latest"</span><span class="nt">&gt;</span>Latest<span class="nt">&lt;/label&gt;</span>
		<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"number"</span> 
			   <span class="na">name=</span><span class="s">"latest"</span> 
			   <span class="na">className=</span><span class="s">"form-control"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>Copying what I already had to turn this into a React component was a very short job. And then I moved onto a little research to see what approaches there were to solve my problem and I stumbled on a JS pub/sub library called <a href="https://github.com/postaljs/postal.js">postal.js</a>.</p>

<blockquote>
  <p>What is it?</p>
</blockquote>

<blockquote>
  <p>Postal.js is an in-memory message bus - very loosely inspired by AMQP - written in JavaScript. Postal.js runs in the browser, or on the server using node.js. It takes the familiar "eventing-style" paradigm (of which most JavaScript developers are familiar) and extends it by providing "broker" and subscriber implementations which are more sophisticated than what you typically find in event emitting/aggregation.</p>
</blockquote>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/** @jsx React.DOM */</span>
<span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">postal</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">postal</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">postal</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">FilterBox</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
    <span class="na">getInitialState</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="na">earliest</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">initialEarliest</span><span class="p">,</span>
            <span class="na">latest</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">initialLatest</span>
        <span class="p">};</span>
    <span class="p">},</span>
    <span class="na">handleEarliestChange</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    	<span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">earliest</span><span class="p">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="mi">10</span><span class="p">)},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    		<span class="nx">postal</span><span class="p">.</span><span class="nx">publish</span><span class="p">({</span>
    			<span class="na">channel</span><span class="p">:</span> <span class="dl">'</span><span class="s1">filters</span><span class="dl">'</span><span class="p">,</span>
    			<span class="na">topic</span><span class="p">:</span> <span class="dl">'</span><span class="s1">year.bounds.change</span><span class="dl">'</span><span class="p">,</span> 
    			<span class="na">data</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span>
    		<span class="p">});</span>
    	<span class="p">});</span>
    <span class="p">},</span>
    <span class="na">handleLatestChange</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    	<span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">latest</span><span class="p">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="mi">10</span><span class="p">)},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    		<span class="nx">postal</span><span class="p">.</span><span class="nx">publish</span><span class="p">({</span>
    			<span class="na">channel</span><span class="p">:</span> <span class="dl">'</span><span class="s1">filters</span><span class="dl">'</span><span class="p">,</span>
    			<span class="na">topic</span><span class="p">:</span> <span class="dl">'</span><span class="s1">year.bounds.change</span><span class="dl">'</span><span class="p">,</span> 
    			<span class="na">data</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span>
    		<span class="p">});</span>
    	<span class="p">});</span>
    <span class="p">},</span>
    <span class="na">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
        	<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">col-xs-12</span><span class="dl">"</span><span class="o">&gt;</span>
        		<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">form-group</span><span class="dl">"</span><span class="o">&gt;</span>
        			<span class="o">&lt;</span><span class="nx">label</span> <span class="nx">htmlFor</span><span class="o">=</span><span class="dl">"</span><span class="s2">earliest</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Earliest</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span>        			<span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">number</span><span class="dl">"</span> 
        				   <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">earliest</span><span class="dl">"</span>
        				   <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">form-control</span><span class="dl">"</span>
        				   <span class="nx">defaultValue</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">earliest</span><span class="p">}</span>
        				   <span class="nx">min</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">initialEarliest</span><span class="p">}</span> 
        				   <span class="nx">max</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">initialLatest</span><span class="p">}</span>
        				   <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleEarliestChange</span><span class="p">}</span><span class="sr">/</span><span class="err">&gt;
</span>        		<span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        		<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">form-group</span><span class="dl">"</span><span class="o">&gt;</span>
        			<span class="o">&lt;</span><span class="nx">label</span> <span class="nx">htmlFor</span><span class="o">=</span><span class="dl">"</span><span class="s2">latest</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Latest</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span>        			<span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">number</span><span class="dl">"</span> 
        				   <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">latest</span><span class="dl">"</span> 
        				   <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">form-control</span><span class="dl">"</span>
        				   <span class="nx">defaultValue</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">latest</span><span class="p">}</span>
        				   <span class="nx">min</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">initialEarliest</span><span class="p">}</span> 
        				   <span class="nx">max</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">initialLatest</span><span class="p">}</span>
        				   <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleLatestChange</span><span class="p">}</span><span class="sr">/</span><span class="err">&gt;
</span>        		<span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        	<span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">FilterBox</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="what-do-we-have">What do we have?</h2>

<h4 id="render">Render</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
    	<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">col-xs-12</span><span class="dl">"</span><span class="o">&gt;</span>
    		<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">form-group</span><span class="dl">"</span><span class="o">&gt;</span>
    			<span class="o">&lt;</span><span class="nx">label</span> <span class="nx">htmlFor</span><span class="o">=</span><span class="dl">"</span><span class="s2">earliest</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Earliest</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span>    			<span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">number</span><span class="dl">"</span> 
    				   <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">earliest</span><span class="dl">"</span>
    				   <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">form-control</span><span class="dl">"</span>
    				   <span class="nx">defaultValue</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">earliest</span><span class="p">}</span>
    				   <span class="nx">min</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">initialEarliest</span><span class="p">}</span> 
    				   <span class="nx">max</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">initialLatest</span><span class="p">}</span>
    				   <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleEarliestChange</span><span class="p">}</span><span class="sr">/</span><span class="err">&gt;
</span>    		<span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    		<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">form-group</span><span class="dl">"</span><span class="o">&gt;</span>
    			<span class="o">&lt;</span><span class="nx">label</span> <span class="nx">htmlFor</span><span class="o">=</span><span class="dl">"</span><span class="s2">latest</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Latest</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span>    			<span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">number</span><span class="dl">"</span> 
    				   <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">latest</span><span class="dl">"</span> 
    				   <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">form-control</span><span class="dl">"</span>
    				   <span class="nx">defaultValue</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">latest</span><span class="p">}</span>
    				   <span class="nx">min</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">initialEarliest</span><span class="p">}</span> 
    				   <span class="nx">max</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">initialLatest</span><span class="p">}</span>
    				   <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleLatestChange</span><span class="p">}</span><span class="sr">/</span><span class="err">&gt;
</span>    		<span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    	<span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here we've added a react specific attribute <code class="language-plaintext highlighter-rouge">defaultValue</code> to set the starting state of the inputs, added min and max validation using properties passed in to the component and an onChange handler specific to each number input.</p>

<h4 id="initial-state">Initial state</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">getInitialState</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">earliest</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">initialEarliest</span><span class="p">,</span>
        <span class="na">latest</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">initialLatest</span>
    <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here the default values for the earliest and latest state are set.</p>

<h4 id="event-handlers">Event Handlers</h4>

<p>These two handlers are the same except for operating on a different property of the state object.</p>

<p>Yes, yes, remove all duplication. But… the duplicate methods are next to each other and I've half a mind to make each control a React component which would remove this duplication so why do that work twice.</p>

<p>(I got all excited about postal.js and wrote this post before finishing the component)</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">handleLatestChange</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span>
		<span class="p">{</span><span class="na">latest</span><span class="p">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="mi">10</span><span class="p">)},</span> 
		<span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">postal</span><span class="p">.</span><span class="nx">publish</span><span class="p">({</span>
				<span class="na">channel</span><span class="p">:</span> <span class="dl">'</span><span class="s1">filters</span><span class="dl">'</span><span class="p">,</span>
				<span class="na">topic</span><span class="p">:</span> <span class="dl">'</span><span class="s1">year.bounds.change</span><span class="dl">'</span><span class="p">,</span> 
				<span class="na">data</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span>
			<span class="p">});</span>
		<span class="p">}</span>
	<span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here when an event is received the function calls <a href="https://web.archive.org/web/20150706092850/http://facebook.github.io/react/docs/component-api.html#setstate"><code class="language-plaintext highlighter-rouge">setState</code></a> on the React component. This merges the object provided as the first argument with the component's current state.</p>

<p>Since that update doesn't necessarily occur immediately the method takes a callback which runs after the update completes.</p>

<p>In this case the callback uses postal to publish a message. Postal allows you to hold a reference to a channel but here we're using a convenience method that allows you to specify the channel.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">postal</span><span class="p">.</span><span class="nx">publish</span><span class="p">({</span>
	<span class="na">channel</span><span class="p">:</span> <span class="dl">'</span><span class="s1">filters</span><span class="dl">'</span><span class="p">,</span>
	<span class="na">topic</span><span class="p">:</span> <span class="dl">'</span><span class="s1">year.bounds.change</span><span class="dl">'</span><span class="p">,</span> 
	<span class="na">data</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span>
<span class="p">});</span>
</code></pre></div></div>

<p>So, on channel 'filters' publish a message with the topic 'year.bounds.change' including the component's state as the message data.</p>

<p>(and yes the first thing I did when subscribing was type in one of those magic strings incorrectly so there's an improvement to be made in my usage there!)</p>

<p>This gives us a phenomenally useless pub/sub mechanism with no subscribers…</p>

<h1 id="subscribing-is-even-harder">Subscribing is even harder</h1>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">componentWillMount</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">postal</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
	  <span class="na">channel</span><span class="p">:</span> <span class="dl">"</span><span class="s2">filters</span><span class="dl">"</span><span class="p">,</span>
	  <span class="na">topic</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">year.bounds.change</span><span class="dl">"</span><span class="p">,</span>
	  <span class="na">callback</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">envelope</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">this</span><span class="p">.</span><span class="nx">filterData</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
	  <span class="p">}</span>
	<span class="p">}).</span><span class="nx">context</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</code></pre></div></div>

<p>Postal's subscribe helper takes an object with the same properties as publish. Here for messages posted to a given channel and topic it will call the provided callback.</p>

<p>The <a href="https://web.archive.org/web/20150706092850/http://facebook.github.io/react/docs/component-specs.html#mounting-componentwillmount"><code class="language-plaintext highlighter-rouge">componentWillMount</code></a> method of the React component is called once before initial rendering so it is perfect for this setup.</p>

<h1 id="messy-pay-table-reacting-to-filtering">Messy Pay Table Reacting to Filtering</h1>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">PayTable</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
    <span class="na">getInitialState</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="na">sortDirection</span><span class="p">:</span> <span class="dl">'</span><span class="s1">descending</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">data</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">payYears</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">sortDescending</span><span class="p">)</span>
        <span class="p">};</span>
    <span class="p">},</span>
    <span class="na">preparePayData</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">yearBounds</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nx">element</span><span class="p">.</span><span class="nx">year</span> <span class="o">&gt;=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">yearBounds</span><span class="p">.</span><span class="nx">earliest</span> 
                            <span class="o">&amp;&amp;</span> <span class="nx">element</span><span class="p">.</span><span class="nx">year</span> <span class="o">&lt;=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">yearBounds</span><span class="p">.</span><span class="nx">latest</span><span class="p">;</span>
                    <span class="p">})</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">sortDirection</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">sortDirection</span><span class="o">===</span><span class="dl">'</span><span class="s1">descending</span><span class="dl">'</span> 
                                <span class="p">?</span> <span class="nx">sortDescending</span>
                                <span class="p">:</span> <span class="nx">sortAscending</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">data</span><span class="p">:</span> <span class="nx">data</span><span class="p">});</span>
    <span class="p">},</span>
    <span class="na">sortData</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">sortDirection</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">sortDirection</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">descending</span><span class="dl">'</span>
                                     <span class="p">?</span> <span class="dl">'</span><span class="s1">ascending</span><span class="dl">'</span>
                                     <span class="p">:</span> <span class="dl">'</span><span class="s1">descending</span><span class="dl">'</span><span class="p">},</span> 
                      <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">preparePayData</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">payYears</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">);</span>
                      <span class="p">})</span>
    <span class="p">},</span>
    <span class="na">filterData</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filterBounds</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">yearBounds</span><span class="p">:</span> <span class="nx">filterBounds</span><span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">preparePayData</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">payYears</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">},</span>
        <span class="na">componentWillMount</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">postal</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
          <span class="na">channel</span><span class="p">:</span> <span class="dl">"</span><span class="s2">filters</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">topic</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">year.bounds.change</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">callback</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">filterData</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}).</span><span class="nx">context</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="p">},</span>
    <span class="na">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">table</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">table table-striped</span><span class="dl">"</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">thead</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="nx">th</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">sortData</span><span class="p">}</span>
                            <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">sortDirection</span><span class="p">}</span><span class="o">&gt;</span>
                            <span class="nx">Year</span>
                        <span class="o">&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                        <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="nx">All</span><span class="o">&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                        <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="nx">Full</span><span class="o">-</span><span class="nx">time</span><span class="o">&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                        <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="nx">Part</span><span class="o">-</span><span class="nx">time</span><span class="o">&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                    <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/thead</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">tbody</span><span class="o">&gt;</span>
                    <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">payYear</span><span class="p">)</span> <span class="p">{</span>
                      <span class="k">return</span> <span class="o">&lt;</span><span class="nx">PayRow</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">payYear</span><span class="p">.</span><span class="nx">year</span><span class="p">}</span> <span class="nx">payYear</span><span class="o">=</span><span class="p">{</span><span class="nx">payYear</span><span class="p">}</span> <span class="sr">/&gt;</span><span class="err">;
</span>                    <span class="p">})}</span>
                <span class="o">&lt;</span><span class="sr">/tbody</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/table</span><span class="err">&gt;
</span>        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">PayTable</code> now has a <code class="language-plaintext highlighter-rouge">preparePayData</code> method which has the responsibility of taking some data and the component's current state and setting the state's data property correctly.</p>

<p>Now all the <code class="language-plaintext highlighter-rouge">filterData</code> and <code class="language-plaintext highlighter-rouge">sortData</code> methods need to do is update state and then call <code class="language-plaintext highlighter-rouge">preparePayData</code>.
<!--alex ignore hook --->
The point here is how useful it was to use postal.js to hook these two components together. I <em>lurve</em> this!</p>

<p><img src="/images/reactotype.gif" alt="demo of the web page" loading="lazy" /></p>

<h1 id="next-up">Next Up</h1>

<p>A little bit of tidying up and add a chart view. #holidaycode</p>

	</div>
	<div class="further-reading">

  

  
    <h1>More like this...</h1>
      
          <a href="/reactotype/part-three.html">
  <div class="article-tile">
      <h3>
        Reactotype Part 3
      </h3>
      <small>
        20 Feb 2015
      </small>
  </div>
</a>
      
          <a href="/reactotype/part-one.html">
  <div class="article-tile">
      <h3>
        Reactotype Part 1
      </h3>
      <small>
        17 Feb 2015
      </small>
  </div>
</a>
      
   
</div>

</article>
    </div>
    <footer>
	<div>
		<a href="https://pauldambra.dev/feed.xml">
			<img src="/images/rss.svg" alt="the rss feed">
			Subscribe to RSS feed
		</a>
	</div>
</footer>

    
    <script>
      var tsl = document.getElementById('twitter-share-link')
      tsl.addEventListener('click', function() {
        ga('send', {
          hitType: 'social',
          socialNetwork: 'twitter',
          socialAction: 'tweet',
          socialTarget: "https://pauldambra.dev/reactotype/part-two.html"
        });
      });

      var fsl = document.getElementById('facebook-share-link')
      fsl.addEventListener('click', function() {
        ga('send', {
          hitType: 'social',
          socialNetwork: 'facebook',
          socialAction: 'share',
          socialTarget: "https://pauldambra.dev/reactotype/part-two.html"
        });
      });
    </script>
    

    <script defer src="/register-service-worker.js"></script>

    <link href="https://fonts.googleapis.com/css?family=Khula&display=swap" rel="stylesheet">

  </body>
</html>
