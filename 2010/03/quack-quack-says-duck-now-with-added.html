<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />

    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" href="/images/icons/icon-152x152.png" />
    <!-- theme-color defines the top bar color-->
    <meta name="theme-color" content="#575757" />
    <meta
      http-equiv="X-Content-Security-Policy"
      content="default-src 'self'; script-src 'report-sample' 'self' https://app.posthog.com/static/array.js https://www.googletagmanager.com/gtag/js; style-src 'report-sample' 'self' https://fonts.googleapis.com; object-src 'none'; base-uri 'self'; connect-src 'self' https://app.posthog.com; font-src 'self'; frame-src 'self'; img-src 'self'; manifest-src 'self'; media-src 'self'; report-uri https://pauldambra.report-uri.com/r/d/csp/enforce; worker-src 'self';"
    />
    <!-- Add to home screen for Safari on iOS-->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="MiRaNo" />
    <link rel="apple-touch-icon" href="/images/icons/icon-152x152.png" />

    <!-- Add to home screen for Windows-->
    <meta
      name="msapplication-TileImage"
      content="/images/icons/icon-152x152.png"
    />
    <meta name="msapplication-TileColor" content="#575757" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Quack Quack Says The Duck now with added threading</title>
    <link rel="canonical" href="https://pauldambra.dev/2010/03/quack-quack-says-duck-now-with-added.html" />
    <meta property="og:url" content="https://pauldambra.dev/2010/03/quack-quack-says-duck-now-with-added.html" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Quack Quack Says The Duck now with added threading" />
    <meta
      property="og:description"
      content="a blog about software engineering"
    />
    <meta
      property="og:image"
      content="https://pauldambra.dev/images/cardboard.jpg"
    />
    <meta name="twitter:creator" content="@pauldambra" />
    <meta property="fb:app_id" content="1029758320473951" />

    <meta name="viewport" content="width=device-width" />
    <meta
      name="description"
      content="a blog about software engineering"
    />
    <meta property="fb:pages" content="1029758320473951" />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="Mindless Rambling Nonsense"
      href="https://pauldambra.dev/feed.xml"
    />
    <link rel="shortcut icon" href="/favicon.ico" />

    <link rel="prefetch" href="/images/cardboard.jpg" />

    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <meta name="msvalidate.01" content="54691C3C7B863CEE60F0305D6EDFF7A8" />
    <meta
      name="google-site-verification"
      content="hLKEdujpXNQ9PSZWEcQkwxCgL2z1tWxVedeaUmttH7c"
    />
    <script>
    !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init Ce Ls Ns Te As js capture Xe calculateEventProperties qs register register_once register_for_session unregister unregister_for_session Gs getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSurveysLoaded onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey canRenderSurveyAsync identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty Hs Us createPersonProfile Ws Os Js opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing get_explicit_consent_status is_capturing clear_opt_in_out_capturing zs debug L Bs getPageViewId captureTraceFeedback captureTraceMetric".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
    posthog.init('phc_pDm161Kiiwh2GfpX1ELnmaMafhvp2EIDYFlWo8f12PK', {
        api_host: 'https://ph.pauldambra.dev',
        ui_host: 'https://ph.pauldambra.dev',
        defaults: '2025-05-24',
        person_profiles: 'identified_only', // or 'always' to create profiles for anonymous users as well
    })
</script>

  </head>
  <body class="flex flex-col h-screen">
    <header class="flex flex-col px-8 pt-4 text-white text-xl" role="banner">
  <div class="flex flex-col sm:flex-row">
    <div class="no-underline hover:underline">
      <a href="/">Mindless Rambling Nonsense</a>
    </div>
    <div class="flex-grow my-2 sm:m-0"></div>
    <div class="flex justify-start items-end flex-col text-sm">
      <div class="flex items-center">
        <div class="mr-4">Paul D'Ambra</div>
        <a href="https://github.com/pauldambra" rel="noopener">
          <img
            src="/images/GitHub-Mark-Light-32px.png"
            alt="pauldambra on github"
            width="32"
            height="32"
          />
        </a>
      </div>
      <div class="flex items-center">
        <div class="mr-4">Fangler</div>
        <a href="https://twitter.com/pauldambra" rel="noopener">
          <img
            src="/images/twitter-32.png"
            alt="pauldambra on twitter"
            width="32"
            height="32"
          />
        </a>
      </div>
      <div class="flex items-center">
        <div class="mr-4"></div>
        <a rel="me" href="https://mastodon.me.uk/@pauldambra">
        </a>
      </div>
    </div>
  </div>
  <div class="flex-grow"></div>
  <div
    class="flex align-middle items-start px-2 py-4 text-white space-x-4 text-lg"
  >
    <nav role="navigation">
      <a class="underline" href="/">Blog Posts</a>
      <a class="underline ml-5" href="/weeknotes.html">Week Notes</a>
      <a class="underline ml-5" href="/kids-games.html">Kids games</a>
    </nav>
  </div>
</header>

    <main role="main" class="bg-white p-4 w-11/12 m-auto flex-auto flex-grow">
      

<script type="application/ld+json">
  {
     "@context":"http://schema.org",
     "@type":"BlogPosting",
     "headline":"Quack Quack Says The Duck now with added threading",
     "genre":"",
     "keywords":"",
     "wordCount":"581",
     "url":"https://pauldambra.dev/2010/03/quack-quack-says-duck-now-with-added.html",
     "datePublished":"2010-03-29",
     "author":{
        "@type":"Person",
        "name":"Paul D'Ambra",
        "sameAs":[
          "https://twitter.com/pauldambra",
          "https://github.com/pauldambra",
          "https://plus.google.com/u/0/+PaulDAmbraPlus"
        ]
     },
     "publisher":{
  "@type": "Organization",
      "name": "Paul D'Ambra",
      "sameAs": [
          "https://twitter.com/pauldambra",
          "https://github.com/pauldambra",
          "https://plus.google.com/u/0/+PaulDAmbraPlus"
      ],
      "logo": {
        "@type": "ImageObject",
        "contentUrl": "https://pauldambra.dev/images/logo.png",
          "url": "https://pauldambra.dev"
      }
     },
     "image":{
        "@type":"ImageObject",
        "contentUrl":"https://pauldambra.dev/images/cardboard.jpg",
        "url":"https://pauldambra.dev",
        "height":"450",
        "width":"1000"
     },
     "mainEntityOfPage":{
        "@type":"WebPage",
        "@id":"https://pauldambra.dev/2010/03/quack-quack-says-duck-now-with-added.html"
     },
     "articleBody":"In  a  previous  post  I  advertised  an  application  I'd  made  for  WinMo  to  entertain  my  toddler.\n\n\nHaving  watched  her  play  with  it  and  having  been  reminded  to  K.I.S.S.  I've  fixed  a  bug  that  highlighted  the  difference  in  expectations  between  myself  and  a  toddler.\n\n\n\nNo  not  the  world-weary  pessimism  I'm  practising  instead  when  I  tested  and  used  the  app  I  would  click  and  then  wait  for  something  to  happen…  whereas  my  toddler  would  bash  at  the  screen  having  got  the  link  between  doing  so  and  stuff  happening.\n\nWhile  the  UI  was  blocking  the  OS  would  register  all  the  clicks  and  then  process  them  before  updating  the  screen.\n\nIn  the  context  of  this  application  that  meant  that  you  could  have  a  sheep  on  screen  that  was  barking  like  a  dog….  not  teaching  my  kid  the  lessons  I  was  hoping!\n\nI  moved  the  actual  sound  playing  onto  a  background  thread  and  set  a  boolean  flag  to  try  to  control  the  click  event\n\nPrivate  Sub  picBox_Click(ByVal  sender  As  Object,  ByVal  e  As  EventArgs)  Handles  picBox.Click\n        If  Not  isPlaying  Then\n                isPlaying  =  True\n                Dim  t  As  Threading.Thread  =  New  Threading.Thread(New  Threading.ThreadStart(AddressOf  playSound))\n                t.Start()\n                t.Join()\n                'playSound  has  finished  now  so...\n                refreshScreen()\n        End  If\nEnd  Sub\n\nPrivate  Sub  playSound()\n        If  currentObject.getSoundLocation()  &lt;&gt;  \"\"  Then\n                currentObject.playSound()\n        End  If\nEnd  Sub\n\nPrivate  Sub  refreshScreen()\n        picBox.Image  =  Nothing\n        currentObject  =  thisCollectionOfThings.getNextObject()\n        If  Not  currentObject  Is  Nothing  Then  addImage()\n        playTimer.Enabled  =  True\nEnd  Sub\n\nPrivate  Sub  playTimer_Tick(ByVal  sender  As  System.Object,  ByVal  e  As  System.EventArgs)  Handles  playTimer.Tick\n        playTimer.Enabled  =  False\n        isPlaying  =  False\nEnd  Sub\n\n\nThe  astute  among  you  (pat  yourselves  on  the  back)  will  notice  that  there's  also  a  timer  in  there…  I  found  that  if  I  hit  the  screen  5  times  (for  example)  during  the  sound  playing  the  last  one  or  two  clicks  would  be  picked  up  and  their  audio  played\nbefore  the  image  finally  refreshed.\n\nI  guess  the  UI  was  blocking  briefly  as  processing  control  passed  from  the  spawned  thread  back  to  the  UI  thread.\n\nSo  I  added  a  short  timer  that  is  started  by  the  refreshScreen  method  and  which  stops  itself  and  resets  the  isPlaying  flag  on  its  first  tick.\n\nThat  might  be  a  bit  hacky  and  there  might  be  a  better  way  but  since  that  seems  to  work  I'm  happy  with  it.\n\nAnd  now  I  have  a  slightly  more  toddler-proof  toddler  game.\n\nAt  the  time  of  writing  you  could  view  all  of  the  source  code  and  download  an  install  cab  at  codeplex  qqstd.codeplex.com  but  that  site  is  unavailable  now  :(  You  can  see  it  in  the  wayback  machine\n"
  }
</script>

<article>
<header class="flex flex-col border-b-black border-b-2 bg-white text-black">
  <div class="heading">
    <div class="date">Mon Mar 29 2010</div>
    <h1 class="title leading-10 pt-2 mb-0 mt-1">Quack Quack Says The Duck now with added threading</h1>
  </div>
  <div class="meta flex-grow flex flex-row">
    <div class="share-this flex self-end space-x-2">
      <a
        id="facebook-share-link"
        class="social-share"
        target="_blank"
        rel="noopener"
        href="https://www.facebook.com/dialog/share?app_id=305449093152216&href=https://pauldambra.dev/2010/03/quack-quack-says-duck-now-with-added.html"
      >
        <img
          class="w-8"
          src="/images/facebook-black-32.png"
          alt="share on facebook"
          width="32"
          height="32"
        />
      </a>
      <a
        id="twitter-share-link"
        class="social-share"
        target="_blank"
        rel="noopener"
        href="https://twitter.com/intent/tweet?text=Quack+Quack+Says+The+Duck+now+with+added+threading&via=pauldambra&url=https://pauldambra.dev/2010/03/quack-quack-says-duck-now-with-added.html"
      >
        <img
          class="w-8"
          src="/images/twitter-black-32.png"
          alt="share on twitter"
          width="32"
          height="32"
        />
      </a>
    </div>
    <div class="more-like-this text-right content-end flex-grow">
      <a
        class="post-metadata"
        href="/categories.html#windows-mobile"
      >
        in: windows-mobile
      </a>
      <div>
<span class="text-slate-500">
  <img class="w-6 h-6 inline-block" src="/images/tag.svg" alt="tag-icon" />
  <a class="no-underline hover:underline" href="/tags.html#parenting">
    parenting
  </a>
</span>

<span class="text-slate-500">
  <img class="w-6 h-6 inline-block" src="/images/tag.svg" alt="tag-icon" />
  <a class="no-underline hover:underline" href="/tags.html#microsoft">
    microsoft
  </a>
</span>

<span class="text-slate-500">
  <img class="w-6 h-6 inline-block" src="/images/tag.svg" alt="tag-icon" />
  <a class="no-underline hover:underline" href="/tags.html#vb-net">
    vb.net
  </a>
</span>

<span class="text-slate-500">
  <img class="w-6 h-6 inline-block" src="/images/tag.svg" alt="tag-icon" />
  <a class="no-underline hover:underline" href="/tags.html#ux">
    ux
  </a>
</span>

</div>
    </div>
  </div>
</header>

	<div class="post">
		<p>In a <a href="http://mindlessramblingnonsense.blogspot.com/2009/10/quack-quack-says-duck.html">previous post</a> I advertised an application I'd made for WinMo to entertain my toddler.</p>

<!--alex ignore her-him-->
<p>Having watched her play with it and having been <a href="http://stackoverflow.com/questions/2498609/handle-windows-mobile-click-event-so-that-it-doesnt-queue-while-my-program-is">reminded to K.I.S.S</a>. I've fixed a bug that highlighted the difference in expectations between myself and a toddler.</p>

<!--more-->

<p>No not the world-weary pessimism I'm practising instead when I tested and used the app I would click and then wait for something to happen… whereas my toddler would bash at the screen having got the link between doing so and stuff happening.</p>

<p>While the UI was blocking the OS would register all the clicks and then process them before updating the screen.</p>

<p>In the context of this application that meant that you could have a sheep on screen that was barking like a dog…. not teaching my kid the lessons I was hoping!</p>

<p>I moved the actual sound playing onto a background thread and set a boolean flag to try to control the click event</p>

<div class="language-visualbasic highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Private</span> <span class="k">Sub</span> <span class="nf">picBox_Click</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">sender</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">,</span> <span class="k">ByVal</span> <span class="n">e</span> <span class="ow">As</span> <span class="n">EventArgs</span><span class="p">)</span> <span class="k">Handles</span> <span class="n">picBox</span><span class="p">.</span><span class="n">Click</span>
    <span class="k">If</span> <span class="k">Not</span> <span class="n">isPlaying</span> <span class="k">Then</span>
        <span class="n">isPlaying</span> <span class="o">=</span> <span class="k">True</span>
        <span class="k">Dim</span> <span class="nv">t</span> <span class="ow">As</span> <span class="n">Threading</span><span class="p">.</span><span class="n">Thread</span> <span class="o">=</span> <span class="k">New</span> <span class="n">Threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="k">New</span> <span class="n">Threading</span><span class="p">.</span><span class="n">ThreadStart</span><span class="p">(</span><span class="ow">AddressOf</span> <span class="n">playSound</span><span class="p">))</span>
        <span class="n">t</span><span class="p">.</span><span class="n">Start</span><span class="p">()</span>
        <span class="n">t</span><span class="p">.</span><span class="n">Join</span><span class="p">()</span>
        <span class="c1">'playSound has finished now so...</span>
        <span class="n">refreshScreen</span><span class="p">()</span>
    <span class="k">End</span> <span class="k">If</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">playSound</span><span class="p">()</span>
    <span class="k">If</span> <span class="n">currentObject</span><span class="p">.</span><span class="n">getSoundLocation</span><span class="p">()</span> <span class="o">&lt;&gt;</span> <span class="s">""</span> <span class="k">Then</span>
        <span class="n">currentObject</span><span class="p">.</span><span class="n">playSound</span><span class="p">()</span>
    <span class="k">End</span> <span class="k">If</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">refreshScreen</span><span class="p">()</span>
    <span class="n">picBox</span><span class="p">.</span><span class="n">Image</span> <span class="o">=</span> <span class="k">Nothing</span>
    <span class="n">currentObject</span> <span class="o">=</span> <span class="n">thisCollectionOfThings</span><span class="p">.</span><span class="n">getNextObject</span><span class="p">()</span>
    <span class="k">If</span> <span class="k">Not</span> <span class="n">currentObject</span> <span class="ow">Is</span> <span class="k">Nothing</span> <span class="k">Then</span> <span class="n">addImage</span><span class="p">()</span>
    <span class="n">playTimer</span><span class="p">.</span><span class="n">Enabled</span> <span class="o">=</span> <span class="k">True</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Private</span> <span class="k">Sub</span> <span class="nf">playTimer_Tick</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">sender</span> <span class="ow">As</span> <span class="n">System</span><span class="p">.</span><span class="n">Object</span><span class="p">,</span> <span class="k">ByVal</span> <span class="n">e</span> <span class="ow">As</span> <span class="n">System</span><span class="p">.</span><span class="n">EventArgs</span><span class="p">)</span> <span class="k">Handles</span> <span class="n">playTimer</span><span class="p">.</span><span class="n">Tick</span>
    <span class="n">playTimer</span><span class="p">.</span><span class="n">Enabled</span> <span class="o">=</span> <span class="k">False</span>
    <span class="n">isPlaying</span> <span class="o">=</span> <span class="k">False</span>
<span class="k">End</span> <span class="k">Sub</span>
</code></pre></div></div>

<p>The astute among you (pat yourselves on the back) will notice that there's also a timer in there… I found that if I hit the screen 5 times (for example) during the sound playing the last one or two clicks would be picked up and their audio played
before the image finally refreshed.</p>

<p>I guess the UI was blocking briefly as processing control passed from the spawned thread back to the UI thread.</p>

<p>So I added a short timer that is started by the <code class="language-plaintext highlighter-rouge">refreshScreen</code> method and which stops itself and resets the <code class="language-plaintext highlighter-rouge">isPlaying</code> flag on its first tick.</p>

<p>That might be a bit hacky and there might be a better way but since that seems to work I'm happy with it.</p>

<p>And now I have a slightly more toddler-proof toddler game.</p>

<p>At the time of writing you could view all of the source code and download an install cab at codeplex <code class="language-plaintext highlighter-rouge">qqstd.codeplex.com</code> but that site is unavailable now :( You can see it <a href="https://web.archive.org/web/20130301150839/http://qqstd.codeplex.com/">in the wayback machine</a></p>

	</div>
	<div class="mt-8">
  
  <h1>More like this...</h1>
   
  <div class="grid grid-cols-3 gap-4"></div> 
  
</div>

</article>
    </main>
    <footer class="w-full h-4 bg-black text-white py-8 px-4">
  <a class="no-underline text-white" href="https://pauldambra.dev/feed.xml">
    <img class="inline w-6 h-6" src="/images/rss.svg" alt="the rss feed" />
    <span>Subscribe to RSS feed</span>
  </a>
</footer>
 
    <script>
      var tsl = document.getElementById("twitter-share-link");
      tsl.addEventListener("click", function () {
        ga("send", {
          hitType: "social",
          socialNetwork: "twitter",
          socialAction: "tweet",
          socialTarget: "https://pauldambra.dev/2010/03/quack-quack-says-duck-now-with-added.html",
        });
      });

      var fsl = document.getElementById("facebook-share-link");
      fsl.addEventListener("click", function () {
        ga("send", {
          hitType: "social",
          socialNetwork: "facebook",
          socialAction: "share",
          socialTarget: "https://pauldambra.dev/2010/03/quack-quack-says-duck-now-with-added.html",
        });
      });
    </script>
    

    <script defer src="/register-service-worker.js"></script>

    <link
      href="https://fonts.googleapis.com/css?family=Khula&display=swap"
      rel="stylesheet"
    />
  </body>
</html>
