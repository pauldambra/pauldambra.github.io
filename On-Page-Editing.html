<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">

    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="/images/icons/icon-152x152.png">
    <!-- theme-color defines the top bar color-->
    <meta name="theme-color" content="#575757"/>
    <meta http-equiv="X-Content-Security-Policy" content="default-src 'self'; script-src 'report-sample' 'self' https://app.posthog.com/static/array.js https://www.googletagmanager.com/gtag/js; style-src 'report-sample' 'self' https://fonts.googleapis.com; object-src 'none'; base-uri 'self'; connect-src 'self' https://app.posthog.com; font-src 'self'; frame-src 'self'; img-src 'self'; manifest-src 'self'; media-src 'self'; report-uri https://pauldambra.report-uri.com/r/d/csp/enforce; worker-src 'self';" />
    <!-- Add to home screen for Safari on iOS-->
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
    <meta name="apple-mobile-web-app-title" content="MiRaNo"/>
    <link rel="apple-touch-icon" href="/images/icons/icon-152x152.png"/>

    <!-- Add to home screen for Windows-->
    <meta name="msapplication-TileImage" content="/images/icons/icon-152x152.png"/>
    <meta name="msapplication-TileColor" content="#575757"/>

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Websites != CMS Platform - On Page Editing</title>
    <link rel="canonical" href="https://pauldambra.dev/On-Page-Editing.html" />
    <meta property="og:url"          content="https://pauldambra.dev/On-Page-Editing.html" />
    <meta property="og:type"         content="article" />
    <meta property="og:title"        content="Websites != CMS Platform - On Page Editing" />
    <meta property="og:description"  content="using contenteditable in HTML5 to make pages editable" />
    <meta property="og:image"        content="https://pauldambra.dev/images/cardboard.jpg" />
    <meta name="twitter:creator" content="@pauldambra" />
    <meta property="fb:app_id"       content="1029758320473951" />

    <meta name="viewport" content="width=device-width">
    <meta name="description" content="using contenteditable in HTML5 to make pages editable">
    <meta property="fb:pages" content="1029758320473951" />
    <link rel="alternate" type="application/rss+xml" title="Mindless Rambling Nonsense" href="https://pauldambra.dev/feed.xml">
    <link rel="shortcut icon" href="/favicon.ico" />

    <link rel="prefetch" href="/images/cardboard.jpg">

    <style>
      .highlight .hll { background-color: #ffffcc }
.highlight  { background: #f0f3f3; }
.highlight .c { color: #0099FF; font-style: italic } /* Comment */
.highlight .err { color: #AA0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #006699; font-weight: bold } /* Keyword */
.highlight .o { color: #555555 } /* Operator */
.highlight .ch { color: #0099FF; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #0099FF; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #009999 } /* Comment.Preproc */
.highlight .cpf { color: #0099FF; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #0099FF; font-style: italic } /* Comment.Single */
.highlight .cs { color: #0099FF; font-weight: bold; font-style: italic } /* Comment.Special */
.highlight .gd { background-color: #FFCCCC; border: 1px solid #CC0000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #003300; font-weight: bold } /* Generic.Heading */
.highlight .gi { background-color: #CCFFCC; border: 1px solid #00CC00 } /* Generic.Inserted */
.highlight .go { color: #AAAAAA } /* Generic.Output */
.highlight .gp { color: #000099; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #003300; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #99CC66 } /* Generic.Traceback */
.highlight .kc { color: #006699; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #006699; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #006699; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #006699 } /* Keyword.Pseudo */
.highlight .kr { color: #006699; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #007788; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #FF6600 } /* Literal.Number */
.highlight .s { color: #CC3300 } /* Literal.String */
.highlight .na { color: #330099 } /* Name.Attribute */
.highlight .nb { color: #336666 } /* Name.Builtin */
.highlight .nc { color: #00AA88; font-weight: bold } /* Name.Class */
.highlight .no { color: #336600 } /* Name.Constant */
.highlight .nd { color: #9999FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #CC0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #CC00FF } /* Name.Function */
.highlight .nl { color: #9999FF } /* Name.Label */
.highlight .nn { color: #00CCFF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #330099; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #003333 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #FF6600 } /* Literal.Number.Bin */
.highlight .mf { color: #FF6600 } /* Literal.Number.Float */
.highlight .mh { color: #FF6600 } /* Literal.Number.Hex */
.highlight .mi { color: #FF6600 } /* Literal.Number.Integer */
.highlight .mo { color: #FF6600 } /* Literal.Number.Oct */
.highlight .sa { color: #CC3300 } /* Literal.String.Affix */
.highlight .sb { color: #CC3300 } /* Literal.String.Backtick */
.highlight .sc { color: #CC3300 } /* Literal.String.Char */
.highlight .dl { color: #CC3300 } /* Literal.String.Delimiter */
.highlight .sd { color: #CC3300; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #CC3300 } /* Literal.String.Double */
.highlight .se { color: #CC3300; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #CC3300 } /* Literal.String.Heredoc */
.highlight .si { color: #AA0000 } /* Literal.String.Interpol */
.highlight .sx { color: #CC3300 } /* Literal.String.Other */
.highlight .sr { color: #33AAAA } /* Literal.String.Regex */
.highlight .s1 { color: #CC3300 } /* Literal.String.Single */
.highlight .ss { color: #FFCC33 } /* Literal.String.Symbol */
.highlight .bp { color: #336666 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #CC00FF } /* Name.Function.Magic */
.highlight .vc { color: #003333 } /* Name.Variable.Class */
.highlight .vg { color: #003333 } /* Name.Variable.Global */
.highlight .vi { color: #003333 } /* Name.Variable.Instance */
.highlight .vm { color: #003333 } /* Name.Variable.Magic */
.highlight .il { color: #FF6600 } /* Literal.Number.Integer.Long */

      
      html { height: 100%; font-size: 20px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); }

html * { box-sizing: border-box; }

body { font-family: "Khula", sans-serif; font-size: 1em; min-height: 100%; display: flex; flex-direction: column; margin: 0; line-height: 1.42857143; }

main { background-color: #fff; padding: 10px 5px; /* flex: 1; would be enough but it looks bad in IE */ flex: 1 1 auto; width: 94%; margin: auto; }

h1 { font-size: 2em; }

h2 { font-size: 1.5em; }

h3 .post-metadata { font-size: 1.2em; }

h3.tag-list { font-size: 1.2em; }

hr { clear: both; }

p { word-wrap: break-word; }

a { color: #000; text-decoration: underline; }

a:visited { color: #000; }

a:hover { color: #000; text-decoration: underline; }

li { margin-left: 0.5em; }

.pagination { text-align: center; word-spacing: 0.75em; }

.pagination a { text-decoration: none; }

.pagination a:hover { text-decoration: underline; }

article header { display: flex; flex-direction: column; border-bottom: #000 solid 2px; background-color: #fff; color: #000; }

article header .heading { flex: 3 0 auto; }

article header .meta { flex: 1 0 auto; display: flex; flex-direction: row; }

@media (max-width: 450px) { article header .meta { flex-direction: column; } }

article header .meta .more-like-this { text-align: right; align-content: flex-end; flex: 3 0 auto; }

article header .meta .post-category { float: none; }

article header .meta .share-this { display: flex; align-self: flex-end; }

article header .meta .share-this a { margin-right: 5px; }

article header .meta .share-this img { width: 32px; height: 32px; }

article #title { line-height: 75px; padding-top: 10px; }

article h1 { -webkit-margin-after: 0; -webkit-margin-before: 5px; margin-bottom: 0; margin-top: 5px; }

blockquote { padding: 5px 10px; margin: 0 0 20px; border-left: 5px solid #eee; }

header { display: flex; flex-direction: column; background-color: #222; color: #fff; padding: 5px 15px 10px 15px; }

header nav, header .top { background-color: rgba(0, 0, 0, 0.3); box-shadow: 0 0 0.5em 0.5em rgba(0, 0, 0, 0.3); padding: 0.5em 1em; }

header nav a + a { margin-left: 1em; }

header .top { display: flex; flex-direction: row; }

@media (max-width: 550px) { header .top { flex-direction: column; } header .top .name { margin-top: 1em; } }

header .separator { flex-grow: 1; }

header.hero { background-image: url("/images/cardboard.jpg"); }

@media (max-width: 600px) { header.hero { background-position: -400px -23px; } }

@media (max-width: 778px) { header.hero { height: 370px; } }

@media (min-width: 778px) { header.hero { height: 437px; } }

@media (min-width: 984px) { header.hero { background-size: 100%; } }

@media (min-width: 1440px) { header.hero { height: 600px; } }

@media (max-height: 320px) { header.hero { height: 250px; } }

header.hero a { color: #fff; text-decoration: underline; }

header.hero a:visited { color: #fff; }

header.hero a:hover { color: #fff; text-decoration: underline; }

header a { color: #aaa; text-decoration: underline; }

header a:visited { color: #aaa; }

header a:hover { color: #aaa; text-decoration: underline; }

header .title a { text-decoration: none; }

@media (min-width: 550px) { header .title { font-size: 150%; font-weight: bold; } }

header .name { display: flex; align-items: flex-end; justify-content: flex-start; flex-direction: column; }

@media (max-width: 750px) { header .name p { justify-content: flex-end; } }

header .name .row { display: flex; align-items: center; }

header .name .row div { margin-right: 15px; }

header .name .row a { height: 32px; }

header p { margin: 0; word-wrap: break-word; }

@media screen and (max-width: 500px) { ul { padding: 0; } }

.excerpt h1 { overflow: hidden; text-overflow: ellipsis; }

.excerpt .series { display: none; }

.categories-list li { list-style: none; margin: 0.2em; }

.short { height: 100px !important; }

.tag-list { font-weight: normal; }

.tag-list li { list-style: none; margin: 0.2em; }

.tag-list .post-category { float: none; }

.tag-list h3 a { color: #000; text-decoration: none; }

.tag-list h3 a:visited { color: #000; }

.tag-list h3 a:hover { color: #000; text-decoration: underline; }

.tag-list a { color: #aaa; text-decoration: none; }

.tag-list a:visited { color: #aaa; }

.tag-list a:hover { color: #aaa; text-decoration: underline; }

.link-list .post-category { float: left; padding: 5px; }

.category-link { font-weight: normal; }

.category-link a { color: #000; text-decoration: none; }

.category-link a:visited { color: #000; }

.category-link a:hover { color: #000; text-decoration: underline; }

.post-metadata { color: #575757; display: inline-block; padding: 1px 3px; }

.post-metadata a { color: #575757; text-decoration: none; }

.post-metadata a:visited { color: #575757; }

.post-metadata a:hover { color: #575757; text-decoration: underline; }

.post-category { float: right; }

.post-category img { fill: #575757; width: 24px; height: 24px; display: inline-block; }

.post-item { -moz-transition: 0.25s; -ms-transition: 0.25s; -o-transition: 0.25s; -webkit-transition: 0.25s; margin-bottom: 20px; transition: 0.25s; display: flex; flex-direction: column; flex: 4 0 auto; }

.post-item:hover { background-color: rgba(245, 245, 245, 0.7); border-radius: 5px; }

.post-item .metadata .post-category { text-align: right; }

img { display: block; max-width: 1000px; vertical-align: middle; width: 100%; margin: auto; }

aside { border-left: 1px solid darkslateblue; color: darkslateblue; margin-bottom: 1em; margin-left: 2em; padding-left: 0.5em; }

aside.series { border-left: none; margin: 0 0 1.5em 0; }

aside.series h1 { font-size: 1em; }

aside.series .links { display: flex; }

aside.series .links .previous { text-align: left; flex: 1 0 auto; }

aside.series .links .next { text-align: right; flex: 1 0 auto; }

.posts { list-style-type: none; margin-bottom: 2em; padding: 0; }

.posts li { line-height: 1.75em; }

footer { padding: 5px 15px; margin: 0 auto; width: 100%; background-color: #000; color: #fff; min-height: 2em; overflow: hidden; height: 30px; }

footer a, footer a:visited, footer a:hover { color: #fff; line-height: 25px; vertical-align: bottom; text-decoration: none; }

footer a img, footer a:visited img, footer a:hover img { width: 25px; height: 25px; line-height: 25px; vertical-align: sub; text-decoration: none; display: inline; }

.paged-weeknotes a { text-decoration: none; }

.further-reading { margin-top: 60px; }

.further-reading a { text-decoration: none; }

.further-reading .article-tile { display: inline-block; width: 30%; margin-right: 1%; border: 1px solid #aaa; padding: 5px; min-height: 10em; text-overflow: ellipsis; vertical-align: top; position: relative; }

@media screen and (max-width: 425px) { .further-reading .article-tile { width: 100%; margin-bottom: 1%; } }

.further-reading .article-tile small { bottom: 5px; position: absolute; right: 5px; }

.highlight { overflow-x: scroll; }

    </style>
    <meta name="msvalidate.01" content="54691C3C7B863CEE60F0305D6EDFF7A8" />
    <meta name="google-site-verification" content="hLKEdujpXNQ9PSZWEcQkwxCgL2z1tWxVedeaUmttH7c" />
    <script>
  !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
  posthog.init('phc_DumQNjXoXRQpyaus5OM861c3BEYtwwKyzVTNmPs1XIt',{api_host:'https://app.posthog.com', _capture_performance: true, debug: true, autocapture: true, capture_pageview: true, disable_session_recording: false })
</script> 
  </head>
  <body>
    <header class="hero" role="banner">
	<div class="top">
		<div class="title">
			<a href="/">Mindless Rambling Nonsense</a>
		</div>
		<div class="separator"></div>
		<div class="name">
			<div class="row">
				<div>Paul D'Ambra</div>
					<a href="https://github.com/pauldambra" rel="noopener">
						<img src="/images/GitHub-Mark-Light-32px.png" alt="pauldambra on github" width="32" height="32">
					</a>
			</div>
			<div class="row">
				<div>Fangler</div>
					<a href="https://twitter.com/pauldambra" rel="noopener">
						<img src="/images/twitter-32.png" alt="pauldambra on twitter" width="32" height="32">
					</a>
			</div>
		</div>
	</div>
	<div class="separator"></div>
	<div class="bottom">
		<nav role="navigation">
			<a href="/">Blog Posts</a>
			<a href="/weeknotes.html">Week Notes</a>
		</nav>
	</div>
</header>

    <main role="main">
      

<script type="application/ld+json">
{  
   "@context":"http://schema.org",
   "@type":"BlogPosting",
   "headline":"Websites != CMS Platform - On Page Editing",
   "genre":"",
   "keywords":"",
   "wordCount":"2123",
   "url":"https://pauldambra.dev/On-Page-Editing.html",
   "datePublished":"2014-06-11",
   "author":{  
      "@type":"Person",
      "name":"Paul D'Ambra",
      "sameAs":[  
        "https://twitter.com/pauldambra",
        "https://github.com/pauldambra",
        "https://plus.google.com/u/0/+PaulDAmbraPlus"
      ]
   },
   "publisher":{  
"@type": "Organization",
    "name": "Paul D'Ambra",
    "sameAs": [
        "https://twitter.com/pauldambra",
        "https://github.com/pauldambra",
        "https://plus.google.com/u/0/+PaulDAmbraPlus"
    ],
    "logo": {
      "@type": "ImageObject",
      "contentUrl": "https://pauldambra.dev/images/logo.png",
        "url": "https://pauldambra.dev"
    }
   },
   "image":{  
      "@type":"ImageObject",
      "contentUrl":"https://pauldambra.dev/images/cardboard.jpg",
      "url":"https://pauldambra.dev",
      "height":"450",
      "width":"1000"
   },
   "mainEntityOfPage":{  
      "@type":"WebPage",
      "@id":"https://pauldambra.dev/On-Page-Editing.html"
   },
   "articleBody":"This  post  is  part  of  a  series  where  I'm  hoping  to  prove  to  myself  that  building  a  dynamic  website  with  NodeJS  is  much  more  fun  than  using  a  CMS  platform.  See  the  first  post  for  an  explanation  of  why\n\nThe  code  can  be  found  on  GitHub\n\nPrevious  Post\n\nA.K.A.  No  More  CMS-y  Admin  Section?\n\nA  traditional  CMS  framework  or  website  has  an  admin  section  for  logged  in  users.  That  section  has  a  menu  showing  them  which  sections  the  user  can  edit  and  each  section  has  a  list  of  the  pages  they  can  edit  and  then  the  user  can  edit  the  text  or  upload  images  using  a  WYSIWYG  editor.\n\nDon't  fix  it  if  it  aint  broken  but…  but…  HTML5  includes  the  contenteditable  attribute  which  makes  (the  text  of)  almost  any  element  editable.\n\nIf  the  admin  section  exists  (in  large  part)  to  allow  editing  of  content  and  editing  of  content  can  be  completed  in  the  page  itself  could  this  replace  the  admin  section?\n\n\n\nCould  it?!\n\nThe  benefit  I  can  see  here  is  that  your  edits  are  in  place.  They're  immediately  reflected  on  screen  so  the  editing  user  can  see  the  impact  they're  having.  A  user  may  not  grok  why  a  developer  has  put  a  25  character  limit  on  a  title  field.  But  if  they  only  change  a  title  and  it  pushes  the  rest  of  the  page  out  then  it's  their  call  whether  that's  OK.\n\nI  can  think  of  two  problems  with  this:\n\n1.  Users  expect  an  admin  interface.\n\nThey  don't  expect  to  edit  in  the  page\n\nI've  previously  referenced  \"Don't  Make  Me  Think\"  (shameless  affiliate  link)  and  that  approach  would  drive  the  position  that  there's  no  point  confusing  a  user  only  to  be  funky.  This  may  be  doing  that…\n\n2.  Is  it  discoverable?\n\nThe  visual  affordance  to  indicate  that  a  user  is  able  to  edit  an  element  needs  to  be  worked  in  to  the  design.\n\nIf  the  user  can't  find  what  to  edit  then  this  doesn't  work.  Also,  since  part  of  the  benefit  is  that  the  edits  are  in  the  page  and  the  page  has  to  change  to  indicate  where  edits  are  possible  does  that  water  down  the  benefit.\n\nI'm  well  out  of  my  depth  as  far  as  design  goes  right  now!  If  this  was  a  real  project  I'd  want  to  get  a  real  designer  or  some  actual  users  at  this  point  and  find  out  if  this  is  a  developer  only  idea…\n\nso  how  does  it  work?\nAs  part  of  this  piece  of  development  I  switched  view  engine  to  the  hbs  engine.  I  wanted  partials  and  handlebars  and  this  appears  to  offer  both  with  little  pain.\n\nrequire('./server/handlebars').init(hbs,  app.locals);\nhbs.registerPartials(__dirname  +  '/views/partials');\napp.engine('html',  hbs.__express);\n\n\nThis  setup  allows  .hbs  files  stored  in  /views/partials  to  be  used  in  {{&gt;partialName  }}  handlebars  blocks\n\nThe  feature  here  is  to  have  three  columns  of  editable  content.  That's  expressed  in  the  home  page  layout…\n\n\n    &lt;div  class=\"row  info\"&gt;\n        {{&gt;panel  panels.[0]}}\n        {{&gt;panel  panels.[1]}}\n        {{&gt;panel  panels.[2]}}\n    &lt;/div&gt;\n\n\n\nEach  line  calls  for  the  panel  partial  and  passes  the  given  element  from  the  panels  array  (or  undefined)\n\nand  a  panel  partial  would  be\n\n\n\t&lt;div  class=\"col-md-4\"&gt;\n        &lt;div  class=\"panel  panel-info\"&gt;\n\t\t    &lt;div  class=\"panel-heading\"&gt;\n                &lt;h1  {{elementShouldBeEditable}}&gt;\n                    {{safeString  title}}\n                &lt;/h1&gt;\n            &lt;/div&gt;\n            &lt;div  class=\"panel-body\"  {{elementShouldBeEditable}}&gt;\n    \t\t    {{safeString  body}}\n            &lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n    \n\n\nEach  element  that  should  be  editable  is  marked  with  an  {{elementShouldBeEditable}}  handlebars  helper  and  the  content  from  the  model  is  marked  as  safeString  so  that  any  HTML  entered  in  the  WYSIWYG  editor  is  not  escaped.\n\nThe  Helpers\n\nAn  editable  element\n\n        handlebars.registerHelper('elementShouldBeEditable',  \n                                                function()  {\n                                                        if  (appLocals.user)  {\n                                                                return  'contenteditable=true';\n                                                        }\n                                                });\n\n\nThis  is  a  standard  Handlebars  helper  which  checks  if  a  user  is  set  and  if  it  is  renders  contenteditable=true  in  place.\n\nSafe  Strings\nIf  a  WYSIWYG  editor  saves  `  some  bold  text  `  then  that  is  exactly  what  will  be  printed  on  screen  as  handlebars  will  escape  the  HTML  to  protect  you  from  l33t  haxxors.\n\n        handlebars.registerHelper('safeString',  function(value)  {\n                return  new  handlebars.handlebars.SafeString(value);\n        });\n\n\nreturning  a  handlebars  safeString  instead  means  that  handlebars  will  trust  the  content  and  render  some  bold  text\n\nThe  JS\nThis  is  the  first  JS  I've  added  to  the  client.  So,  while  I  initially  wrote  the  JS  directly  in  the  HTML,  I  eventually  moved  it  into  its  own  files  and  hooked  up  gulp  to  concat  and  uglify  it.\n\nGulp\n\nvar  concat  =  require('gulp-concat');\nvar  uglify  =  require('gulp-uglify');\n\ngulp.task('processJS',  function(){\n    gulp.src(['./public/js/*.js'])\n        .pipe(concat('app.js'))\n        .pipe(uglify())\n        .pipe(gulp.dest('./public/js/'));\n});\n\n\nThe  gulp  task  is  straightforward.  On  any  change  in  a  JS  file  in  the  public/js  folder    concat  all  the  js  files  in  that  folder  into  a  file  called  app.js,  uglify  that  file  and  save  it.\n\nThe  main  HTML  page  is  then  set  to  include  that  JS  when  a  user  is  logged  in\n\n\n        {{#if  user}}\n                &lt;script  src=\"/js/app.js\"&gt;&lt;/script&gt;\n        {{/if}}\n    \n\n\nMonitor  the  page  for  changes\nThe  first  task  is  to  watch  any  contenteditable  elements  for  changes  to  their  content  and  to  do  something  when  a  change  is  detected\n\n(function(omniclopse,  $)  {\n        'use  strict';\n        \n        //shamelessly  borrowed  from  http://stackoverflow.com/a/14027188/222163\n        omniclopse.bindEvents  =  function()  {\n\n                var  before;\n                var  timer;\n                $('*[contenteditable]').on('focus',  function()  {\n                    before  =  $(this).html();\n                }).on('keyup  paste',  function()  {  \n                    if  (before  !=  $(this).html())  {  \n                        clearTimeout(timer);\n                        timer  =  setTimeout(omniclopse.onContentEdited,  500);\n                    }\n                });\n        };        \n}(window.omniclopse  =  window.omniclopse  ||  {},  $));\n\n\nThis  JS  watched  any  element  with  a  contenteditable  attribute  and  if  an  element  gets  focus  stores  the  HTML  content  as  it  was  on  focus.  On  keyup  or  paste  if  the  content  has  changed  then  queue  a  call  to  the  onContentEdited  event  handler.\n\nThis  has  a  500  millisecond  delay  so  that  the  system  waits  until  a  person  has  stopped  editing  before  taking  any  action.\n\nRespond  to  changes\nWhen  a  change  is  detected  then  the  page  is  PUT  to  the  server  to  persist  those  changes\n\n(function(omniclopse,  $)  {\n        'use  strict';\n\n        //snip  out  addMessage  for  clarity  of  example\n        \n        omniclopse.onContentEdited  =  function()  {\n            var  panels  =  $('.panel').map(function(index,  el)  {\n                var  title  =  $(el).find('h1');\n                var  body  =  $(el).find('.panel-body');\n                return  {\n                    title:  title  ?  title.text()  :  '',\n                    body:  body?  body.html()  :  ''\n                };\n            }).get();\n\n            var  putData  =  {'panels':  panels};\n            $.ajax({\n                url:'/pages/home',\n                dataType:'json',\n                contentType:'application/json',\n                data:JSON.stringify(putData),\n                type:'PUT'\n            }).fail(function(xhr,status){\n                addMessage('could  not  save  your  changes',  'alert-danger');\n            }).done(function(){\n                addMessage('saved  changes',  'alert-success');\n            });\n        };\n\n}(window.omniclopse  =  window.omniclopse  ||  {},  $));\n\n\nSo  here  the  page  object  expected  by  the  server  is  gathered  from  the  page  and  PUT  using  $.ajax.  This  bit  of  code  is  bound  directly  to  the  Home  page  at  the  moment  but  that  can  be  remedied  when  necessary.\n\nAn  addMessage  function  shows  a  bootstrap  alert  to  keep  the  user  informed  of  what  is  happening.  This  is  a  pretty  dull  piece  of  code!\n\n        function  alertTimeout(wait){\n                setTimeout(function(){\n                        $('#messageHolder').children('.alert:first-child').alert().alert('close');\n                },  wait);\n        }\n\n        var  addMessage  =  function(message,  bootstrapType)  {\n            var  outer  =  $('&lt;div/&gt;',  {\n                class:  'alert  alert-dismissable  '  +  bootstrapType\n            });\n            var  button  =  $('&lt;button/&gt;',{\n                type:'button',\n                class:'close',\n                'data-dismiss':'alert',\n                'aria-hidden':'true',\n            });\n            button.append('&amp;times;');\n            outer.append(button);\n            outer.append(message);\n            $('#messageHolder').append(outer);\n            alertTimeout(3000);\n        };  \n\n\nVisual  Affordance\nI  found  this  a  pretty  hard  design  decision.  I'm  not  sure  I'm  happy  it  really  calls  out  what  is  happening  to  a  user  and  I  think  I'll  grab  a  designer  the  next  time  I'm  next  to  one  and  ask  their  opinion  but…\n\n\n\n\n\n@mixin  editorPencil($size)  {\n\tcontent:  \"\\270f    \";\n\tfont-family:  'Glyphicons  Halflings';\n\tfont-style:  normal;\n\tfont-size:  $size;\n}\n\ndiv[contenteditable]:before  {\n\t@include  editorPencil(1em);\n}\n\nh1[contenteditable]:before  {\n\t@include  editorPencil(0.5em);\n}\n\n\nSince  the  site  is  already  using  bootstrap  CSS  was  added  that  uses  :before  to  add  a  pencil  icon  to  any  contenteditable  div  or  H1.\n\nCKEditor\nAnother  little  bonus  is  that  CKEditor  is  aware  of  contenteditable  elements  so  including  that  in  the  page  gives  you  WYSIWYG  power  directly  on  any  contenteditable.\n\nAll  that  was  necessary  to  hook  it  up  was  to  include  it  in  the  page  and  to  switch  from  using  the  valid  &lt;div  content  contenteditable/&gt;  to  using  &lt;div  content  contenteditable=true/&gt;  a  change  I  can  live  with  to  get  the  power  of  WYSIWYG  directly  on  page  elements\n\n(How)  does  it  work?\nIf  you  watch  the  GIF  below  it's  clear  this  is  a  working  prototype  and  not  a  finished  product.  But  it  does  work!\n\nThe  page  content  is  jumping  about  as  alert  messages  are  added  and  that's  not  OK  so  a  better  mechanism  is  necessary  for  highlighting  that  changes  have  been  persisted.\n\nBut  this  was  really  fun  to  add  and  it  needed  very  little  code  to  do  so.\n\n\n"
}
</script>
<article>
<header>
	<div class="heading">
		<div class="date">
			Wed Jun 11 2014
		</div>
		<h1 class="title">Websites != CMS Platform - On Page Editing</h1>
	</div>
	<div class="meta">
		<div class="share-this">
			<a id="facebook-share-link" 
			   class="social-share" 
			   target="_blank"
			   rel="noopener"
			   href="https://www.facebook.com/dialog/share?app_id=305449093152216&href=https://pauldambra.dev/On-Page-Editing.html">
				<img src="/images/facebook-black-32.png" alt="share on facebook" width="32" height="32">
			</a>
			<a id="twitter-share-link"
			   class="social-share" 
			   target="_blank"
			   rel="noopener"
			   href="https://twitter.com/intent/tweet?text=Websites+%21%3D+CMS+Platform+-+On+Page+Editing&via=pauldambra&url=https://pauldambra.dev/On-Page-Editing.html">
				<img src="/images/twitter-black-32.png" alt="share on twitter" width="32" height="32">
			</a>
		</div>
		<div class="more-like-this">
			<a class="post-metadata post-category"
				href="/categories.html#cms">
				in: cms
			</a>
			<div>
				
	<span class="post-category">
		<img src="/images/tag.svg" alt="tag-icon"/>
		<a class="post-metadata"
			href="/tags.html#learning">
			learning
		</a>
	</span>

	<span class="post-category">
		<img src="/images/tag.svg" alt="tag-icon"/>
		<a class="post-metadata"
			href="/tags.html#cms">
			cms
		</a>
	</span>

	<span class="post-category">
		<img src="/images/tag.svg" alt="tag-icon"/>
		<a class="post-metadata"
			href="/tags.html#design">
			design
		</a>
	</span>

	<span class="post-category">
		<img src="/images/tag.svg" alt="tag-icon"/>
		<a class="post-metadata"
			href="/tags.html#web">
			web
		</a>
	</span>

	<span class="post-category">
		<img src="/images/tag.svg" alt="tag-icon"/>
		<a class="post-metadata"
			href="/tags.html#series">
			series
		</a>
	</span>

			</div>
		</div>
	</div>
</header>
	<div class="post">
		<p>This post is part of a series where I'm hoping to prove to myself that building a dynamic website with NodeJS is much more fun than using a CMS platform. <a href="/2014/02/websites-cms.html">See the first post for an explanation of why</a></p>

<p>The code can be found on <a href="https://github.com/pauldambra/omniclopse">GitHub</a></p>

<p><a href="/Websites-CMS-Platform-Storing-Data2.html">Previous Post</a></p>

<p>A.K.A. No More CMS-y Admin Section?</p>

<p>A traditional CMS framework or website has an admin section for logged in users. That section has a menu showing them which sections the user can edit and each section has a list of the pages they can edit and then the user can edit the text or upload images using a WYSIWYG editor.</p>

<p>Don't fix it if it aint broken but… but… HTML5 includes <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Content_Editable">the <code class="language-plaintext highlighter-rouge">contenteditable</code> attribute</a> which makes (the text of) almost any element editable.</p>

<p>If the admin section exists (in large part) to allow editing of content and editing of content can be completed in the page itself could this replace the admin section?</p>

<!--more-->

<h3 id="could-it">Could it?!</h3>

<p>The benefit I can see here is that your edits are in place. They're immediately reflected on screen so the editing user can see the impact they're having. A user may not grok why a developer has put a 25 character limit on a title field. But if they only change a title and it pushes the rest of the page out then it's their call whether that's OK.</p>

<p>I can think of two problems with this:</p>

<h4 id="1-users-expect-an-admin-interface">1. Users expect an admin interface.</h4>

<p>They don't expect to edit in the page</p>

<p>I've previously referenced "Don't Make Me Think" <a href="https://www.amazon.co.uk/Dont-Make-Me-Think-Usability/dp/B00HJUBRPG/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1473701528&amp;sr=1-1&amp;keywords=Don%27t+Make+Me+Think%3A+A+Common+Sense+Approach+to+Web+Usability+%28Voices+That+Matter%29">(shameless affiliate link)</a> and that approach would drive the position that there's no point confusing a user only to be funky. This may be doing that…</p>

<h4 id="2-is-it-discoverable">2. Is it discoverable?</h4>

<p>The visual affordance to indicate that a user is able to edit an element needs to be worked in to the design.</p>

<p>If the user can't find what to edit then this doesn't work. Also, since part of the benefit is that the edits are in the page and the page has to change to indicate where edits are possible does that water down the benefit.</p>

<p>I'm well out of my depth as far as design goes right now! If this was a real project I'd want to get a real designer or some actual users at this point and find out if this is a developer only idea…</p>

<h1 id="so-how-does-it-work">so how does it work?</h1>
<p>As part of this piece of development I switched view engine to the <a href="https://github.com/donpark/hbs">hbs engine</a>. I wanted partials and handlebars and this appears to offer both with little pain.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./server/handlebars</span><span class="dl">'</span><span class="p">).</span><span class="nx">init</span><span class="p">(</span><span class="nx">hbs</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">locals</span><span class="p">);</span>
<span class="nx">hbs</span><span class="p">.</span><span class="nx">registerPartials</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">/views/partials</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">engine</span><span class="p">(</span><span class="dl">'</span><span class="s1">html</span><span class="dl">'</span><span class="p">,</span> <span class="nx">hbs</span><span class="p">.</span><span class="nx">__express</span><span class="p">);</span>
</code></pre></div></div>

<p>This setup allows .hbs files stored in <code class="language-plaintext highlighter-rouge">/views/partials</code> to be used in <code class="language-plaintext highlighter-rouge">{{&gt;partialName }}</code> handlebars blocks</p>

<p>The feature here is to have three columns of editable content. That's expressed in the home page layout…</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row info"</span><span class="nt">&gt;</span>
    {{&gt;panel panels.[0]}}
    {{&gt;panel panels.[1]}}
    {{&gt;panel panels.[2]}}
  <span class="nt">&lt;/div&gt;</span>

</code></pre></div></div>

<p>Each line calls for the panel partial and passes the given element from the panels array (or undefined)</p>

<p>and a panel partial would be</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
	<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel panel-info"</span><span class="nt">&gt;</span>
		  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-heading"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h1</span> <span class="err">{{</span><span class="na">elementShouldBeEditable</span><span class="err">}}</span><span class="nt">&gt;</span>
          {{safeString title}}
        <span class="nt">&lt;/h1&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-body"</span> <span class="err">{{</span><span class="na">elementShouldBeEditable</span><span class="err">}}</span><span class="nt">&gt;</span>
  		  {{safeString body}}
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  
</code></pre></div></div>

<p>Each element that should be editable is marked with an <code class="language-plaintext highlighter-rouge">{{elementShouldBeEditable}}</code> handlebars helper and the content from the model is marked as <code class="language-plaintext highlighter-rouge">safeString</code> so that any HTML entered in the WYSIWYG editor is not escaped.</p>

<h2 id="the-helpers">The Helpers</h2>

<h2 id="an-editable-element">An editable element</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nx">handlebars</span><span class="p">.</span><span class="nx">registerHelper</span><span class="p">(</span><span class="dl">'</span><span class="s1">elementShouldBeEditable</span><span class="dl">'</span><span class="p">,</span> 
                        <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">appLocals</span><span class="p">.</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
                                <span class="k">return</span> <span class="dl">'</span><span class="s1">contenteditable=true</span><span class="dl">'</span><span class="p">;</span>
                            <span class="p">}</span>
                        <span class="p">});</span>
</code></pre></div></div>

<p>This is a standard Handlebars helper which checks if a user is set and if it is renders <code class="language-plaintext highlighter-rouge">contenteditable=true</code> in place.</p>

<h3 id="safe-strings">Safe Strings</h3>
<p>If a WYSIWYG editor saves ` <b>some bold text</b> ` then that is exactly what will be printed on screen as handlebars will escape the HTML to protect you from l33t haxxors.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nx">handlebars</span><span class="p">.</span><span class="nx">registerHelper</span><span class="p">(</span><span class="dl">'</span><span class="s1">safeString</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">handlebars</span><span class="p">.</span><span class="nx">handlebars</span><span class="p">.</span><span class="nx">SafeString</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">});</span>
</code></pre></div></div>

<p>returning a handlebars safeString instead means that handlebars will trust the content and render <strong>some bold text</strong></p>

<h1 id="the-js">The JS</h1>
<p>This is the first JS I've added to the client. So, while I initially wrote the JS directly in the HTML, I eventually moved it into its own files and hooked up gulp to concat and uglify it.</p>

<h3 id="gulp">Gulp</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">concat</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">gulp-concat</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">uglify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">gulp-uglify</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="dl">'</span><span class="s1">processJS</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">([</span><span class="dl">'</span><span class="s1">./public/js/*.js</span><span class="dl">'</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">concat</span><span class="p">(</span><span class="dl">'</span><span class="s1">app.js</span><span class="dl">'</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">uglify</span><span class="p">())</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="dl">'</span><span class="s1">./public/js/</span><span class="dl">'</span><span class="p">));</span>
<span class="p">});</span>
</code></pre></div></div>

<p>The gulp task is straightforward. On any change in a JS file in the public/js folder  concat all the js files in that folder into a file called app.js, uglify that file and save it.</p>

<p>The main HTML page is then set to include that JS <strong>when a user is logged in</strong></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    {{#if user}}
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/js/app.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    {{/if}}
  
</code></pre></div></div>

<h3 id="monitor-the-page-for-changes"><a name="edit-event-js">Monitor the page for changes</a></h3>
<p>The first task is to watch any contenteditable elements for changes to their content and to do <em>something</em> when a change is detected</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">omniclopse</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>
    
    <span class="c1">//shamelessly borrowed from http://stackoverflow.com/a/14027188/222163</span>
    <span class="nx">omniclopse</span><span class="p">.</span><span class="nx">bindEvents</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">before</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">timer</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">*[contenteditable]</span><span class="dl">'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">focus</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">before</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">html</span><span class="p">();</span>
        <span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">keyup paste</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
          <span class="k">if</span> <span class="p">(</span><span class="nx">before</span> <span class="o">!=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">html</span><span class="p">())</span> <span class="p">{</span> 
            <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
            <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">omniclopse</span><span class="p">.</span><span class="nx">onContentEdited</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">};</span>    
<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">omniclopse</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">omniclopse</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">$</span><span class="p">));</span>
</code></pre></div></div>

<p>This JS watched any element with a contenteditable attribute and if an element gets focus stores the HTML content as it was on focus. On keyup or paste if the content has changed then queue a call to the onContentEdited event handler.</p>

<p>This has a 500 millisecond delay so that the system waits until a person has stopped editing before taking any action.</p>

<h3 id="respond-to-changes">Respond to changes</h3>
<p>When a change is detected then the page is PUT to the server to persist those changes</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">omniclopse</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

    <span class="c1">//snip out addMessage for clarity of example</span>
    
    <span class="nx">omniclopse</span><span class="p">.</span><span class="nx">onContentEdited</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">panels</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.panel</span><span class="dl">'</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="dl">'</span><span class="s1">h1</span><span class="dl">'</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="dl">'</span><span class="s1">.panel-body</span><span class="dl">'</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="na">title</span><span class="p">:</span> <span class="nx">title</span> <span class="p">?</span> <span class="nx">title</span><span class="p">.</span><span class="nx">text</span><span class="p">()</span> <span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
          <span class="na">body</span><span class="p">:</span> <span class="nx">body</span><span class="p">?</span> <span class="nx">body</span><span class="p">.</span><span class="nx">html</span><span class="p">()</span> <span class="p">:</span> <span class="dl">''</span>
        <span class="p">};</span>
      <span class="p">}).</span><span class="kd">get</span><span class="p">();</span>

      <span class="kd">var</span> <span class="nx">putData</span> <span class="o">=</span> <span class="p">{</span><span class="dl">'</span><span class="s1">panels</span><span class="dl">'</span><span class="p">:</span> <span class="nx">panels</span><span class="p">};</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span><span class="dl">'</span><span class="s1">/pages/home</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">dataType</span><span class="p">:</span><span class="dl">'</span><span class="s1">json</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">contentType</span><span class="p">:</span><span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">data</span><span class="p">:</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">putData</span><span class="p">),</span>
        <span class="na">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">PUT</span><span class="dl">'</span>
      <span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span><span class="nx">status</span><span class="p">){</span>
        <span class="nx">addMessage</span><span class="p">(</span><span class="dl">'</span><span class="s1">could not save your changes</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">alert-danger</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">addMessage</span><span class="p">(</span><span class="dl">'</span><span class="s1">saved changes</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">alert-success</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">};</span>

<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">omniclopse</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">omniclopse</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">$</span><span class="p">));</span>
</code></pre></div></div>

<p>So here the page object expected by the server is gathered from the page and PUT using <code class="language-plaintext highlighter-rouge">$.ajax</code>. This bit of code is bound directly to the Home page at the moment but that can be remedied when necessary.</p>

<p>An addMessage function shows a bootstrap alert to keep the user informed of what is happening. This is a pretty dull piece of code!</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">function</span> <span class="nx">alertTimeout</span><span class="p">(</span><span class="nx">wait</span><span class="p">){</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#messageHolder</span><span class="dl">'</span><span class="p">).</span><span class="nx">children</span><span class="p">(</span><span class="dl">'</span><span class="s1">.alert:first-child</span><span class="dl">'</span><span class="p">).</span><span class="nx">alert</span><span class="p">().</span><span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">close</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">},</span> <span class="nx">wait</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">addMessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">bootstrapType</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">outer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;div/&gt;</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">class</span><span class="p">:</span> <span class="dl">'</span><span class="s1">alert alert-dismissable </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">bootstrapType</span>
      <span class="p">});</span>
      <span class="kd">var</span> <span class="nx">button</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;button/&gt;</span><span class="dl">'</span><span class="p">,{</span>
        <span class="na">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">button</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">class</span><span class="p">:</span><span class="dl">'</span><span class="s1">close</span><span class="dl">'</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">data-dismiss</span><span class="dl">'</span><span class="p">:</span><span class="dl">'</span><span class="s1">alert</span><span class="dl">'</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">aria-hidden</span><span class="dl">'</span><span class="p">:</span><span class="dl">'</span><span class="s1">true</span><span class="dl">'</span><span class="p">,</span>
      <span class="p">});</span>
      <span class="nx">button</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">'</span><span class="s1">&amp;times;</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">outer</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">button</span><span class="p">);</span>
      <span class="nx">outer</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#messageHolder</span><span class="dl">'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">outer</span><span class="p">);</span>
      <span class="nx">alertTimeout</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
    <span class="p">};</span> 
</code></pre></div></div>

<h1 id="visual-affordance">Visual Affordance</h1>
<p>I found this a pretty hard design decision. I'm not sure I'm happy it really calls out what is happening to a user and I think I'll grab a designer the next time I'm next to one and ask their opinion but…</p>

<p><img src="/images/affordance-loggedout.png" alt="editable sections for anonymous users" loading="lazy" /></p>

<p><img src="/images/affordance-loggedin.png" alt="editable sections for anonymous users" loading="lazy" /></p>

<div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">@mixin</span> <span class="nf">editorPencil</span><span class="p">(</span><span class="nv">$size</span><span class="p">)</span> <span class="p">{</span>
	<span class="nl">content</span><span class="p">:</span> <span class="s2">"\270f  "</span><span class="p">;</span>
	<span class="nl">font-family</span><span class="p">:</span> <span class="s1">'Glyphicons Halflings'</span><span class="p">;</span>
	<span class="nl">font-style</span><span class="p">:</span> <span class="nb">normal</span><span class="p">;</span>
	<span class="nl">font-size</span><span class="p">:</span> <span class="nv">$size</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">div</span><span class="o">[</span><span class="nt">contenteditable</span><span class="o">]</span><span class="nd">:before</span> <span class="p">{</span>
	<span class="k">@include</span> <span class="nd">editorPencil</span><span class="p">(</span><span class="m">1em</span><span class="p">);</span>
<span class="p">}</span>

<span class="nt">h1</span><span class="o">[</span><span class="nt">contenteditable</span><span class="o">]</span><span class="nd">:before</span> <span class="p">{</span>
	<span class="k">@include</span> <span class="nd">editorPencil</span><span class="p">(</span><span class="m">0</span><span class="mi">.5em</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Since the site is already using bootstrap CSS was added that uses <code class="language-plaintext highlighter-rouge">:before</code> to add a pencil icon to any contenteditable div or H1.</p>

<h1 id="ckeditor">CKEditor</h1>
<p>Another little bonus is that CKEditor is aware of contenteditable elements so including that in the page gives you WYSIWYG power directly on any contenteditable.
<!--alex ignore hook --->
All that was necessary to hook it up was to include it in the page and to switch from using the valid <code class="language-plaintext highlighter-rouge">&lt;div content contenteditable/&gt;</code> to using <code class="language-plaintext highlighter-rouge">&lt;div content contenteditable=true/&gt;</code> a change I can live with to get the power of WYSIWYG directly on page elements</p>

<h1 id="how-does-it-work">(How) does it work?</h1>
<p>If you watch the GIF below it's clear this is a working prototype and not a finished product. But it does work!</p>

<p>The page content is jumping about as alert messages are added and that's not OK so a better mechanism is necessary for highlighting that changes have been persisted.</p>

<p>But this was really fun to add and it needed very little code to do so.</p>

<p><img src="/images/editing.gif" alt="editing the page" loading="lazy" /></p>

	</div>
	<div class="further-reading">

  

  
    <h1>More like this...</h1>
      
          <a href="/wrapping_up.html">
  <div class="article-tile">
      <h3>
        Websites != CMS Platform - Wrapping Up
      </h3>
      <small>
        03 Aug 2014
      </small>
  </div>
</a>
      
          <a href="/better-affordance-js.html">
  <div class="article-tile">
      <h3>
        Websites != CMS Platform - Better Editable Affordance with JS for great good
      </h3>
      <small>
        30 Jul 2014
      </small>
  </div>
</a>
      
          <a href="/better-affordance.html">
  <div class="article-tile">
      <h3>
        Websites != CMS Platform - Better Editable Affordance
      </h3>
      <small>
        20 Jul 2014
      </small>
  </div>
</a>
      
   
</div>

</article>
    </div>
    <footer>
	<div>
		<a href="https://pauldambra.dev/feed.xml">
			<img src="/images/rss.svg" alt="the rss feed">
			Subscribe to RSS feed
		</a>
	</div>
</footer>

    
    <script>
      var tsl = document.getElementById('twitter-share-link')
      tsl.addEventListener('click', function() {
        ga('send', {
          hitType: 'social',
          socialNetwork: 'twitter',
          socialAction: 'tweet',
          socialTarget: "https://pauldambra.dev/On-Page-Editing.html"
        });
      });

      var fsl = document.getElementById('facebook-share-link')
      fsl.addEventListener('click', function() {
        ga('send', {
          hitType: 'social',
          socialNetwork: 'facebook',
          socialAction: 'share',
          socialTarget: "https://pauldambra.dev/On-Page-Editing.html"
        });
      });
    </script>
    

    <script defer src="/register-service-worker.js"></script>

    <link href="https://fonts.googleapis.com/css?family=Khula&display=swap" rel="stylesheet">

  </body>
</html>
